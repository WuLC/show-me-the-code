F.module("mantpl:nav/mine_view",function(d,e,g){var h=$("#s_xmancard_mine .s-block-nav");var c='<span class="sp_sg_name">{{=it[4]}}</span><span class="sp_sg_url">{{=it[1]}}</span>';var j=d("superui:component/tips");var b=d("superui:util/dot");var i=d("superui:util/smDot");var f='<div class="dir-item dir-blank s-opacity-blank3" data-dir="#{dirId}" style="position:absolute;"><div class="dir-border s-opacity-blank3"></div><div class="white-border"></div><div class="dir-name s-opacity-blank3"><span class="name-text">#{dirName}</span><input type="text" value="#{dirName}" class="edting-dir-name" maxlength="19"/></div><div class="dir-content s-opacity-blank3"></div><div class="del-dir"><span class="del-dir-icon"></span><span class="del-dir-text">删除分类</span></div></div>';var k='<div class="nav-blank"><div class="add-nav"></div></div>';function a(){this.SUG_TPL=c;this.DIR_TPL=f}a.prototype={blankFy:function(){h.addClass("block-blank");$(".s-mblock-content",h).children().remove().end().removeAttr("style").unbind("mousedown mouseup click").removeClass("sui-componentWrap").html(k)},showDirs:function(m,n){var p;if((p=m.find(".nav-dirs-layer"))[0]){p.show()}else{var o='<div class="nav-dirs-layer"><div class="dir-item" data-dir="-1">未选择分类</div>{{~it.dirs :dir:index}}<div class="dir-item" data-dir="{{=dir.dirId}}">{{=dir.dirName}}</div>{{~}}</div>';var l=b.compile(o)({dirs:n.getNavData().dirs});m.append(l)}m.removeClass("showed").addClass("showed")},hideDirs:function(l,m){var n;if((n=l.find(".nav-dirs-layer"))[0]){n.hide()}l.removeClass("showed")},initPlaceHolder:function(l){F.use("superui:component/placeholder",function(m){l.nameHolder=new m({componentWrap:$(".sug-name-wrap",l.AddPannel.body),top:1,left:29,identity:"mineAddSug",target:$(".sug-name",l.AddPannel.body),holderText:"名称",height:30,lineheight:30});l.netHolder=new m({componentWrap:$(".sug-link-wrap",l.AddPannel.body),top:1,left:14,identity:"mineAddSug",target:$(".sug-link",l.AddPannel.body),holderText:"网址",height:30,lineheight:30})})},pannelSwitch:function(l,n,m){if(l==1){$(".nav-sug-wrap",n.body).addClass("classify");m.sugInstance[0].options("width",531);m.sugInstance[1].options("width",531)}else{$(".nav-sug-wrap",n.body).removeClass("classify");m.sugInstance[0].options("width",681);m.sugInstance[1].options("width",681)}},initTips:function(m,l){l.successTips=new j({target:l,identity:"navsugsccuss",content:"添加成功!",timing:2000,icons:"success",align:"center",theme:"white",arrowUp:false,autoShow:false,theme:"nav-success"});l.warnTips=new j({target:l,identity:"navsugwarn",content:"您已添加过该网址！",timing:2000,icons:"warning",theme:"white",align:"center",arrowUp:false,autoShow:false,theme:"nav-success"});l.alertTips=new j({target:l,identity:"navsugalert",content:"添加超过上限!",timing:2000,icons:"warning",theme:"white",align:"center",arrowUp:false,autoShow:false,theme:"nav-success"});for(var n in m.sugTwo){m.sugTwo[n].errorTips=new j({target:m.sugTwo[n],identity:"navsugerror",content:"请输入有效网址",timing:2000,arrowDown:false,icons:"error",theme:"white",align:"left",autoShow:false});m.sugTwo[n].failTips=new j({target:m.AddPannel.body.find(".sug-content"),identity:"navsugfail",content:"添加失败",timing:2000,arrowDown:false,arrowLeft:"center",icons:"error",theme:"white",align:"center",arrowUp:false,autoShow:false})}},dirTips:function(n,m){var l=this;if(!l[n]){l[n]=new j({target:$(".tool-add-dir",h),identity:"navsugsccuss",content:m,timing:2000,model:"left",arrowDown:false,arrowLeft:"center",icons:"error",theme:"white",align:"center",autoShow:false})}l[n].show()},initSug:function(l){var n=l.sugTwo[0];var o=l.sugTwo[1];l.sugInstance=[];F.use("superui:component/suggestion",function(p){l.sugInstance[0]=new p({componentWrap:$(".sug-content",l.AddPannel.body),identity:"navAddPannel",input:n,width:l.sugWidth,url:$.url.escapeSSL("http://nssug.baidu.com/su?wd={wd}&prod=superpage&json=1"),template:c,autoFill:null,focusShow:false});l.sugInstance[1]=new p({componentWrap:$(".sug-content",l.AddPannel.body),identity:"navAddPannel",input:o,posRefer:n,width:l.sugWidth,url:$.url.escapeSSL("http://nssug.baidu.com/su?wd={wd}&prod=superpage&json=1"),template:c,autoFill:null,focusShow:false})});for(var m=0;m<2;m++){l.sugInstance[m].on("onSelect",function(p){o.val(p[1]);n.val(p[4]);if($.isIE<=9){l.nameHolder.hide();l.netHolder.hide()}})}},showIndir:function(m,p){var o=this;var n=$(".edit-indir",h);var l=$(".edit-tool .edit-add",h);if(m){if(!o.IndirHolder){F.use("superui:component/placeholder",function(q){o.IndirHolder=new q({componentWrap:$(".edit-indir",h),top:5,left:10,identity:"mineAddDir",target:$(".tool-add-dir",h),holderText:"快速创建分类",height:22,lineheight:22})})}n.show();l.hide()}else{n.find(".tool-add-dir").val("");n.hide();l.show()}if(p){n.hide();l.hide()}},getTopDom:function(){return h},cSugMaker:function(l){this.C_SUG_TPL='<div class="nav-sug-wrap#{classsi}"><div class="sug-name-wrap"><input type="text" class="sug-name"/></div><div class="sug-link-wrap"><input type="text" class="sug-link"/></div><div class="sug-my-dirs"><input class="sug-dir-input" value="未选择分类" data-dir="-1" readonly="readonly" disabled="disabled"/><div class="input-icon"></div></div><div class="sug-button">添加网址</div></div>';var m=l=="1"?" classify":"";return $.formatString(this.C_SUG_TPL,{classsi:m})},itemMaker:function(l,p,m){var o=l==="1"?"d-nav-item":"nav-item";var n='<div class="<&$oneItem.typeClass&> new-added" data-nav="<&$oneItem.id&>" data-url="<&$oneItem.url&>"><a class="border-for-item<&if $oneItem.fanliurl&> fanli-item-border<&/if&>" href="<&$oneItem.url&>"  data-fanliurl="<&$oneItem.fanliurl&>" target="_blank"><div class="nav-del"><div class="del-icon"></div></div><img src="<&$oneItem.iconUrl&>" alt="<&$oneItem.name&>" height="16" width="16" class="nav-icon"/><div class="nav-text"><span class="nav-text-content"><&$oneItem.name|sp_escape_html&></span><&if $oneItem.fanliurl&><span class="s-fanli-tag" data-fanlimall="<&$oneItem.fanliMallUrl&>" title="<&$oneItem.fanlititle&>"></span><&/if&></div></a></div>';return i.template(n,{varname:"oneItem"})({typeClass:o,id:p.id,iconUrl:$.url.escapeSSL(p.iconUrl),name:p.name,url:p.url,fanliurl:p.fanliurl,fanliMallUrl:p.fanliMallUrl,fanlititle:p.fanlititle})},pItemTpl:function(){return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-id="{{=item.id}}" data-url="{{=item.url}}"><span class="recom-icon"></span><span class="recom-text">{{=item.name}}</span></div>'},editConMaker:function(l){return'<input type="text" value="'+l+'" class="edting-dir-name" maxlength="19"/>'}};return new a()});F.module("mantpl:nav/mine",function(k,E,e){var r=k("mantpl:nav/mine_view");var h=k("superui:component/tips");var t=$.parseJSON($.trim($("#s_minenav_textarea").html()));var s=0;var y=r.getTopDom();var A=null;var q=k("superui:component/draggdirs");var z=k("superui:component/draggsort");var g=k("superui:component/dialog");var l=k("superui:component/placeholder");var c=k("superui:util/smDot");var j="d-drag-item";var o="dir-item";var v="dir-blank";var G=r.SUG_TPL;var f=r.DIR_TPL;var i=256;var p=c.template('<div class="nav-edit-name" data-id="<&$it.id&>" data-dir="<&$it.dirId&>" url="<&$it.url&>"><input value="<&$it.name&>"/></div><div class="nav-edit-url"><input value="<&$it.url&>"/></div>',{varname:"it"});var b=1;function u(H){F.inherit(n,H);A=new n()}function n(){this.constructor();this.id=b;this.blockDom=y;this.recomBlock="nplus";this.editDom=$(".edit-tool",y);this.reqParam={refreshParam:{isClassify:t.isClassify}};if(t.navCount==="0"){this.isBlank=true}this.isClassify=t.isClassify;this.sorted=false;this.draggSort=null;this.draggClass=null;this.init();this.initEditTips();this.hasPannelBody=true;this.bindEvent();this.domTip=null;this.allDom=$("#s_content_100")}n.prototype={bindEvent:function(){var H=this;y.delegate(".edit-class","click",function(I){if(H.isSimp==true){H.expand()}if($(this).hasClass("classed")){$(this).removeClass("classed");H.classFyAction()}else{$(this).addClass("classed");H.unClassFyAction()}e.fire("navOpration",{oprateMod:b,opration:$(this).hasClass("classed")?"classed":"unclassed"})}).delegate("."+j,"mouseenter mouseleave",function(I){if(I.type==="mouseenter"){$("."+o,y).attr("CANCELDRAG",1)}else{if(!$(this).attr("CANCELDRAG")){$("."+o,y).removeAttr("CANCELDRAG")}}}).delegate(".edit-add","click",function(I){r.showIndir.call(H,true);I.stopPropagation()}).delegate(".edit-indir","click",function(I){I.stopPropagation()}).delegate(".dir-enter","click",function(J){var I=$(this).parents(".edit-indir");H.addDir(I.find(".tool-add-dir").val())}).delegate(".dir-cancel","click",function(I){r.showIndir.call(H,false)}).delegate(".add-nav","click",function(I){H.add()}).delegate(".border-for-item","click",function(J){if(y.hasClass("edting-block")){J.preventDefault()}else{if(H.contentDom.hasClass("block-nav-fanli")&&!!$(this).attr("data-fanliurl")){var I=$(this).attr("data-fanliurl");window.open(I);e.fire("mNavClick",{oprateMod:b,opration:"navclick",url:I});J.preventDefault()}else{var I=$(this).attr("href");e.fire("mNavClick",{oprateMod:b,opration:"navclick",url:I})}}$(this).parents("[data-nav]").removeClass("new-added")}).delegate(".edting-dir-name","mousemove dragstart focusout",function(I){if(I.type==="dragstart"){I.preventDefault()}I.stopPropagation();if(I.type==="focusout"){H.dirRename($(I.target))}}).delegate(".dir-item","mousedown",function(I){if(!$(I.target).hasClass("edting-dir-name")&&y.hasClass("edting-block")){I.preventDefault()}}).delegate(".s-fanli-tag","click",function(J){var I=$(this).attr("data-fanlimall");window.open(I);e.fire("mNavClick",{oprateMod:b,opration:"navclick",url:I});J.stopPropagation();J.preventDefault()}).delegate(".nav-item-edit","click",function(N){var M=$(this).parents(".border-for-item");var L=M.offset();var P=M.width();var O=H.allDom.offset();var I=$.trim(M.find(".nav-text-content").html());var K=$(this).parents("[data-nav]").attr("data-nav");var J=$(this).parents("[data-nav]").attr("data-url");var Q=$(this).parents(".dir-item").attr("data-dir")||0;H.editDialog.window.find(".sui-dialog-body").html(p({name:I,url:J,id:K,dirId:Q}));H.editDialog.show();if($.isIE==6){H.editDialog.mask.height($("#s_content_100").height())}H.editDialog.window.css({left:(L.left-O.left+i)>H.editDialog.mask.width()?L.left-O.left+P-i:L.left-O.left,top:L.top-O.top,marginLeft:0,marginTop:0})});$(".tool-add-dir").bind("keydown",function(J){var K=J.keyCode?J.keyCode:J.which?J.which:J.charCode;if(K===13){J.returnValue=false;var I=$(this).parents(".edit-indir");H.addDir(I.find(".tool-add-dir").val())}})},initEditTips:function(){var H=this;this.editDialog=new g({componentWrap:$("#s_xmancard_mine"),identity:"minenavtips",content:"我是内容",buttons:["确定","取消"],autoShow:false,hasClose:false,width:i,theme:"nav-edit"});this.editDialog.on("acting-ok",function(){var J=$(".nav-edit-name").attr("data-id");var I=$.trim($(".nav-edit-url").find("input").val());I=I==$(".nav-edit-name").attr("url")?"":I;$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"modify",dirId:"",id:J,tabid:b,name:$.trim($(".nav-edit-name").find("input").val()),url:I},function(K){if(K.errNo==0){var M=K.data;var L=$("div[data-nav="+J+"]",y);L.find(".nav-text-content").html(M.name);L.find("a").attr({title:M.name,href:M.url});L.attr({"data-nav":M.id,"data-url":M.url});$(".nav-edit-name[data-id="+J+"]",y).attr("url",M.url);L.find("img").attr("src",$.url.escapeSSL(M.iconUrl));H.editDialog.hide()}else{H.editNavTipsCheck(H.editDialog.body.find(".nav-edit-url"),C(K));H.editNavTips.show()}});if($.isIE<=10){window.event.returnValue=false}return false})},getNavData:function(){return t},dirRename:function(H){var J=H.val();var M=H.parents("[data-dir]").attr("data-dir");var I=this;if(J!=""){var L=false;$(".dir-name .name-text",y).each(function(){if($.trim($(this).html())==J&&$(this).parents("[data-dir]").attr("data-dir")!=M){L=true;I.editDirTips(I.dialog.body.find(".edting-dir-name"))}});if(!L){H.parents(".dir-name").find(".name-text").html(J);if(I.AddPannel){var K=H.parents("[data-dir]").attr("data-dir");$('.nav-dirs-layer [data-dir="'+K+'"]',I.AddPannel.body).html(J)}I.draggFetch({cmd:"rename_dir",dirId:M,dirName:J})}}},classFyAction:function(){var H=this;H.classify(false,function(){$(".edit-add",y).hide();$("."+v,y).hide()});H.contentDom.addClass("block-classed");t.isClassify="1";r.showIndir.call(H,false)},unClassFyAction:function(){var H=this;H.classify(true,function(){$(".edit-add",y).show();$("."+v,y).show()});H.contentDom.removeClass("block-classed");t.isClassify="0";r.showIndir.call(H,false)},refreshCb:function(I,H){this.contentDom.unbind("mousedown mouseup click").children().remove().end().remove();this.contentDom=$(I.html).filter(".s-mblock-content");$(".s-block-container",y).append(this.contentDom);t=$.parseJSON($.trim($("#s_minenav_textarea").html()));s=0;this.sorted=false;this.isBlank=!parseInt(t.navCount);if(s_session.sid.indexOf("18096")>-1||s_session.sid.indexOf("18097")>-1){var K=/mine-title-num[^\(]+\([^\d]+(\d+)/gi,J;J=K.exec(I.html);$(".mine-title-num span",y).html(J[1])}},editCb:function(){if(this.isSimp==true){this.expand()}$("."+o,y).show();if(!this.sorted){if(t.isClassify==="1"){this.draggClass=D.call(this,true,this.draggFetch)}else{this.draggSort=D.call(this,false,this.draggFetch)}this.sorting=true}else{$("."+j,y).removeAttr("CANCELDRAG")}if(t.isClassify==="1"){$("."+v,y).show();this.draggClass.draggAll.collapse();this.draggClass.draggAll.sort(null,true);r.showIndir(false)}else{r.showIndir(false,true)}$(".dir-name",y).each(function(){$(".edting-dir-name",this).val($.trim($(".name-text",this).html()))});$(".edting-block .d-nav-item .border-for-item").addClass("s-opacity-border4-top s-opacity-border4-bottom s-opacity-border4-left s-opacity-border4-right");$(".edting-block .nav-item .border-for-item").addClass("s-opacity-border4-top s-opacity-border4-bottom s-opacity-border4-left s-opacity-border4-right");this.editDom.show()},unEditCb:function(){$(".nav-item .border-for-item").removeClass("s-opacity-border4-top s-opacity-border4-bottom s-opacity-border4-left s-opacity-border4-right");$(".d-nav-item .border-for-item").removeClass("s-opacity-border4-top s-opacity-border4-bottom s-opacity-border4-left s-opacity-border4-right");var H=this;$("."+j,y).attr("CANCELDRAG","1");$("."+o,y).attr("CANCELDRAG","1");if(t.isClassify==="1"){$("."+v,y).hide();H.draggClass.draggAll.collapse();H.draggClass.draggAll.sort(null,true)}if($("."+j,y).length==0){H.isBlank=true;H.contentDom.addClass("block-blank");H.refresh()}$(".edit-indir",y).hide().val("");$(".edit-add",y).show();H.sorting=false;H.editDom.hide()},classify:function(J,H){var I=this;I.reqParam.refreshParam.isClassify=J?1:0;I.refresh(function(K){I.refreshCb(K);H&&H();if(J){$("."+v,y).hide()}})},draggFetch:function(H){w.call(this,H,function(I){})},editDirTips:function(I){var H=this;if(!H.editTips){H.editTips=new h({target:I,identity:"dirrepeat",content:"目录名重复",timing:2000,arrowDown:false,arrowLeft:"center",icons:"error",theme:"yellow",align:"center",arrowUp:false,autoShow:true})}else{H.editTips.hide();H.editTips.target=I;H.editTips.show()}},editNavTipsCheck:function(J,H){var I=this;I.editNavTips=new h({target:J,identity:"navcheck",content:H,timing:2000,arrowLeft:30,icons:"error",theme:"yellow",align:"left",arrowUp:false,autoShow:true})},pannelParam:function(){this.sugWidth=681;if(t.isClassify=="1"){this.sugWidth=531}var H=r.cSugMaker(t.isClassify);return{sugTpl:H,title:"添加网址",itemTpl:r.pItemTpl()}},addCb:function(H){var I=this;if(I.isSimp==true){I.expand();I.isSimp=false}if(!H){r.pannelSwitch(t.isClassify,I.AddPannel,I);I.AddPannel.window.css({top:Math.min(100+$(window).scrollTop(),$("#s_wrap").height()+$("#head_wrapper").height()-I.AddPannel.window.height())});return}I.AddPannel.window.css({top:Math.min(100+$(window).scrollTop(),$("#s_wrap").height()+$("#head_wrapper").height()-I.AddPannel.window.height())});I.sugTwo=[$(".sug-name",I.AddPannel.body),$(".sug-link",I.AddPannel.body)];var J=$(".sug-dir-input",I.AddPannel.body);r.initPlaceHolder(I);r.initSug(I);this.domTip=$(".nav-sug-wrap");r.initTips(I,I.domTip);I.AddPannel.body.delegate(".sug-button","click",function(N){var K=-1;var L=0;var O=d(I.sugTwo[0].val(),I.sugTwo[1].val());if(!O.suc){I.sugTwo[O.tipPos].errorTips.show();I.sugTwo[O.tipPos].val("").focus();for(var M in I.sugTwo){I.sugInstance[M].clearResult()}return}I.add2Dir({navName:I.sugTwo[0].val(),link:O.url},J,function(P){for(var Q in I.sugTwo){I.sugTwo[Q].val("").focus();I.sugInstance[Q].hide();I.sugInstance[Q].clearResult()}I.domTip.successTips.show();$(".sug-dir-input").val("未选择分类").attr("data-dir","-1");r.hideDirs($(".sug-my-dirs"),I)})}).delegate(".sug-my-dirs","click",function(K){if($(this).hasClass("showed")){r.hideDirs($(this),I)}else{r.showDirs($(this),I)}K.stopPropagation()}).delegate(".dir-item","click",function(K){J.attr("data-dir",$(this).attr("data-dir"));J.val($(this).html());r.hideDirs($(".sug-my-dirs"),I);$(".nav-dirs-layer",I.AddPannel.body).hide();K.stopPropagation()}).on("click",function(K){r.hideDirs($(".sug-my-dirs"),I)});I.AddPannel.on("onHide",function(K){return;r.hideDirs($(".sug-my-dirs"),I);I.sugTwo[0].val("");I.sugTwo[1].val("");if(I.addHappen){setTimeout(function(){I.addHappen=false},500)}e.fire("navOpration",{oprateMod:b,opration:"closeWindow"})});I.AddPannel.componentWrap.on("click",function(K){r.hideDirs($(".sug-my-dirs"),I)})},recomAddCb:function(I,H,J){this.add2Dir({navName:$.trim(I.find(".recom-text").html()),link:I.attr("data-url"),target:I},null,H,J)},recomDelCb:function(I,H){this.delItem({navName:$.trim(I.find(".recom-text").html()),link:I.attr("data-url"),navId:I.attr("data-id")},H)},add2Dir:function(I,O,H,J){var K=this;var L=I.link;try{L=decodeURIComponent(I.link)}catch(M){L=I.link}var N={cmd:"add",from:"u_layer",name:I.navName,url:L,customDirId:O?(O.attr("data-dir")||-1):-1};w.call(this,N,function(P){J&&J();if(P.errNo=="6004"){K.domTip.warnTips.show();return false}else{if(P.errNo=="501"){K.domTip.alertTips.show();return false}else{if(P.errNo=="500"){K.sugTwo[0].failTips.target=I.target||K.sugTwo[0];K.sugTwo[0].failTips.show();return false}else{if(parseInt(P.errNo)!=0){K.sugTwo[0].failTips.target=I.target||K.sugTwo[0];K.sugTwo[0].failTips.show();return false}}}}if(K.isBlank){K.isBlank=false;$(".set-menu",y).removeClass("blank-menu");K.sorted=false;setTimeout(function(){K.refresh(function(Q){K.contentDom.unbind("mousedown mouseup click").children().remove().end().html("").removeClass("block-blank");K.refreshCb.call(K,Q);$(".nav-item",K.contentDom).addClass("new-added")})},800)}else{K.addItem(P.data)}H&&H(P)})},addItem:function(K,M){var H=this;var N=r.itemMaker(t.isClassify,K,H);var Q=K.dirId;var I=null;var J=null;if(!H.sorted){if(t.isClassify==="1"){I=$('[data-dir="'+Q+'"] .dir-content',y);$('[data-dir="'+Q+'"]',y).show().removeClass(v)}else{I=$(".s-mblock-content",y)}H.trimDom(I);I.append(N)}else{if(t.isClassify==="1"){for(var L in H.draggClass.draggdirs){var Q=H.draggClass.draggdirs[L].selected.componentWrap.parents("[data-dir]").attr("data-dir");if(Q===K.dirId){J=H.draggClass.draggdirs[L].selected;break}}}else{J=H.draggSort}var P=$(N).addClass("d-drag-item").css({position:"absolute"});if(!H.sorting){P.attr("CANCELDRAG",1)}var O;J.append(P);J.sort(null,true);if((O=J.componentWrap.parents("[data-dir]")).hasClass(v)){O.removeClass(v).show();H.draggClass.draggAll.collapse();$(".sui-draggsort-holder",O).hide()}if(t.isClassify==="1"){H.draggClass.draggAll.collapse();H.draggClass.draggAll.sort(null,true)}}},delItem:function(J,H){var I=this;var L=J.navId;if(!I.sorted){var K={cmd:"del_nav",name:J.navName,url:J.link,ids:L,customDirId:"-1"};w.call(this,K,function(M){if(t.isClassify=="1"){var N=$('[data-nav="'+L+'"]',y).parents(".dir-item");if(N.find(".d-nav-item").length==1){N.addClass("dir-blank").hide()}$('[data-nav="'+L+'"]',y).remove()}else{$('[data-nav="'+L+'"]',y).remove()}H&&H();I.addHappen=true})}else{$('[data-nav="'+L+'"] .del-icon',y).trigger("click");if(t.isClassify==="1"){$("."+v,y).hide();I.draggClass.draggAll.collapse();I.draggClass.draggAll.sort(null,true)}H&&H()}},addDir:function(J){var K={cmd:"add_dir",dirName:J};var H=0;$(".dir-name .name-text",y).each(function(){if($.trim($(this).html())==J){H=1}else{if(J==""){H=2}}});if($(".dir-item",y).length>=30){H=3}if(H===1){r.dirTips("repeatTip","该分类已存在");return false}else{if(H===2){r.dirTips("emptyTip","名称不能为空");return false}else{if(H===3){r.dirTips("emptyTip","添加超过上限");return false}}}var I=this;$(".tool-add-dir",y).val("");w.call(this,K,function(M){var Q=M.data.dirId;var O=M.data.dirName;var L=$.formatString(f,{dirName:O,dirId:Q});var P=$(L);var N=I.draggClass.draggAll;N.append(P);N.sort(null,true,function(){var S=x.call(P.find(".dir-content"),I.draggClass.draggdirs,I.draggClass.draggAll);S.checkData();I.draggClass.draggdirs.push(S)});var R='<div class="dir-item" data-dir="'+Q+'">'+O+"</div>";$(".nav-dirs-layer").append(R);t.dirs.push({dirId:Q,dirName:O})});r.showIndir.call(I,false)},fanli:function(J){var I=$(".fanli-class",y);var H=this;I.toggleClass("classed");if(I.hasClass("classed")){H.contentDom.removeClass("block-nav-fanli").addClass("block-nav-fanli")}else{H.contentDom.removeClass("block-nav-fanli")}F.use("superman:common/user_attr",function(K){K.setAttr("navQuanyiTip",I.hasClass("classed"))})}};function w(I,H){I=F.mix(I,{tabid:1});$.ajaxpost("/home/subscribe/submit/manoperation",I,function(K){H&&H(K);e.fire("navOpration",{oprateMod:b,opration:I.cmd.replace("_","-")});if(parseInt(K.errNo)===0){if(I.cmd==="add"){var J=$(".mine-title-num span",y);J.html(parseInt(J.html())+1)}else{if(I.cmd==="del_nav"){var J=$(".mine-title-num span",y);J.html(parseInt(J.html())-1)}}}})}function D(I,H){this.sorted=true;if(I){$(".dir-item .d-nav-item",y).addClass(j);return m.call(this,H)}else{$(".nav-item",y).addClass(j);return a.call(this,H)}}function a(I){var J=new z({componentWrap:$(".s-mblock-content",y),identity:"minenav",dragsort:"."+j,dragHandle:".h",delAble:true,delSelector:".nav-del .del-icon",containment:$(".s-mblock-content",y),placeholder:false,preventDefault:false});var H={};var L="";J.drags.each(function(){var M=$(this).attr("data-daraggsort");H[M]=$(this).attr("data-nav")});var K=$(".s-mblock-content",y);J.on("onAfterSort",function(Q){L="";for(var P=0,N=Q.cache,M=N.length;P<M;P++){var O=K.find('[data-daraggsort="'+N[P]+'"]');if(P==0){L=O.attr("data-nav");continue}L+=","+O.attr("data-nav")}var R={cmd:"seq_in",seqid:Q.dragItem.attr("data-nav"),dirId:0,ids:L};I&&I(R)}).on("onSortDel",function(N){var M=N.delItem.attr("data-nav");var O={cmd:"del_nav",ids:M,dirIds:"0",isNplus:"0"};s++;I&&I(O);if(s_session.sid.indexOf("18096")>-1||s_session.sid.indexOf("18097")>-1){e.fire("navunsubscribe",{id:N.delItem.attr("data-nav")})}});return J}function m(H){var K=B.call(this,H);var J=[];$(".dir-item .dir-content",y).each(function(){x.call(this,J,K,H)});for(var I in J){J[I].checkData()}return{draggAll:K,draggdirs:J}}function x(L,K,H){var I=$(this).parents("[data-dir]").attr("data-dir");var J=new q({cansort:true,identity:"minenav",dragsort:"."+j,dirId:I,dir:$(this),delAble:true,containment:$(".s-mblock-content",y),delSelector:".nav-del .del-icon",blankClass:v,preventDefault:false});L.push(J);J.on("onAfterSelect",function(S){var R={};S.fromSort.drags.each(function(){var V=$(this).attr("data-daraggsort");R[V]=$(this).attr("data-nav")});if(S.changed===true){var O={};S.toSort.drags.each(function(){var V=$(this).attr("data-daraggsort");O[V]=$(this).attr("data-nav")});var Q="";var N="";for(var T=0,M=S.fromSort.cache,U=M.length;T<U;T++){if(T==0){Q=R[M[T]];continue}Q+=","+R[M[T]]}for(var T=0,M=S.toSort.cache,U=M.length;T<U;T++){if(T==0){N=O[M[T]];continue}N+=","+O[M[T]]}var P={cmd:"seq_out",fromDirId:S.fromSort.componentWrap.parents(".dir-item").attr("data-dir"),toDirId:S.toSort.componentWrap.parents(".dir-item").attr("data-dir"),fromIds:Q,toIds:N,seqid:S.dragItem.attr("data-nav")};H&&H(P)}else{var Q="";for(var T=0,M=S.fromSort.cache,U=M.length;T<U;T++){if(T==0){Q=R[M[T]];continue}Q+=","+R[M[T]]}var P={cmd:"seq_in",ids:Q,seqid:S.dragItem.attr("data-nav"),dirId:S.fromSort.componentWrap.parents(".dir-item").attr("data-dir")};H&&H(P)}}).on("onExchange",function(M){K.sort(null,true);K.collapse()}).on("onDel",function(O){var N=O.dataNav;var M=O.dataDir;var P={cmd:"del_nav",isNplus:"1",dirIds:M,ids:N};s++;H&&H(P);O.fromSort.blankFy();K.sort(null,true);K.collapse()});return J}function C(H){var I="";switch(parseInt(H.errNo)){case 6004:I="该网址已存在";break;case 6001:I="导航已满，请删除不常用网址";break;case 6014:I="分类不存在";break;default:I="添加失败"}return I}function d(J,I){var H=$.trim(I);var L="";var N="";var K=true;var M=H.match(/^(http|ftp|https):\/\//);J=$.trimAll($.trim(J));if(!M){H="http://"+H}if(!/^(http|ftp|https):\/\/([\w-]+(:[\w-]+)?@)?[\w-]+(\.[\w-]+)+(:[\d]+)?([#\/\?][^\s<>;"\']*)?$/.test(H)){L="请输入有效网址";N=1;src="url";K=false}else{if(H.length>1024){L="网址超长！";N=1;src="url";K=false}else{if(!J){src="name";L="请输入名称";N=0;K=false}else{if(new RegExp("<|>|'|\"|/|\\\\").test(J)){L="导航名称不能包含 ' \" < > \\ / 等特殊字符。";N=0;src="name";K=false}else{if(J.length>128){L="名称超长！";N=0;src="name";K=false}}}}}return{suc:K,tip:L,tipPos:N,url:H,name:J}}function B(H){var I=new z({componentWrap:$(".s-mblock-content",y),identity:"minenav",dragsort:"."+o,dragHandle:".h",placeholder:false,oneColDiff:true,delAble:true,containment:$(".s-mblock-content",y),delSelector:".del-dir",saveEnergy:false,preventDefault:false});var J={};I.drags.each(function(){var K=$(this).attr("data-daraggsort");J[K]=$(this).attr("data-dir")});I.on("onAfterSort",function(N){var P="";for(var M=0,L=N.cache,K=L.length;M<K;M++){if(M==0){P=J[L[M]];continue}P+=","+J[L[M]]}var O={cmd:"seq_dir",dirIds:P,dirId:N.dragItem.attr("data-dir")};H&&H(O)}).on("onSortDel",function(M){var O={cmd:"del_dir",dirIds:M.delItem.attr("data-dir")};$(".nav-dirs-layer").find('[data-dir="'+O.dirIds+'"]').remove();var N=-1;for(var L=0,K=t.dirs.length;L<K;L++){if(t.dirs[L].dirId==O.dirIds){N=L}}t.dirs.splice(N,1);H&&H.call(A,O)});return I}E.init=u});F.addLog("mantpl:nav",{navOpration:"1100002001",mNavClick:"1100003001"});F.module("mantpl:stock/mine",function(k,r,h){var c=null;var p=$.parseJSON($.trim($("#s_minestock_textarea").html()));var q=$("#s_xmancard_mine .s-block-stock");var j="stock-item";var e=12;var f=k("superui:util/smDot");var s='<span class="sp-sg-code">{{=it["code"]}}</span><span class="sp-sg-name">{{=it["name"]}}</span><span class="sp-sg-market">{{=it["market"]}}</span>';var l=f.template($(".tpl-area",q).text(),{varname:"oneStock"});f.template("",{varname:"it"});function n(t){F.inherit(g,t);c=new g()}function g(){this.constructor();this.id=e;this.blockDom=q;this.recomBlock="stock";this.editExpand=true;this.init();this.bindEvent()}g.prototype={freshDom:function(x,w){var u=this;var y="";var t=0;if(w){u.contentDom.unbind("mousedown mouseup click").children().remove();u.contentDom.remove();u.contentDom=w;q.find(".s-block-container").append(u.contentDom);x=$.parseJSON($.trim($("#s_minestock_textarea",w).html())).stocks;var t=x.length;if(t>0){u.isBlank=false;u.sorted=false;$(".stock-banner",q).removeClass("stock-banner-hide")}else{$(".stock-banner",q).addClass("stock-banner-hide")}$(".mine-title-num span",q).html(t);return}for(var v in x){y+=i.call(u,x[v]);t++}if(t>0){u.isBlank=false;u.sorted=false;u.contentDom.unbind("mousedown mouseup click").children().remove().end().html(y);$(".stock-banner",q).removeClass("stock-banner-hide")}else{u.blankfy()}},refreshCb:function(t){if(this.isSimp===true){this.expand()}this.freshDom(null,$(t.html).filter(".s-mblock-content"))},bindEvent:function(){var t=this;q.delegate(".add-stock","click",function(u){t.add()}).delegate(".stock-item .stock-link","click",function(w){var u=$(this).parents(".stock-item");if(u.attr("canceldrag")=="1"||!u.attr("data-daraggsort")){var x="";if(u.attr("data-market")==="stockus"){x+=" 美股"}else{x+=" 股票"}var v="//www.baidu.com/s?wd="+u.data("code")+x+"&ie=utf-8&tn=SE_baiduhomet1_zehq5d4k&rsv_idx=2";window.open(v);h.fire("stockClick",{oprateMod:e,opration:"stockclick",url:v})}})},editCb:function(){if(this.isSimp===true){this.expand()}if(!this.sorted){a.call(this,this.draggFetch)}else{$("."+j,q).removeAttr("CANCELDRAG")}},unEditCb:function(){var t=this;if($(".stock-item",q).length===0){t.isBlank=true}$("."+j,q).attr("CANCELDRAG","1");if($("."+j,q).length==0){t.refresh()}},blankfy:function(){var t='<div class="stock-blank"><div class="add-stock"></div></div>';this.isBlank=true;this.contentDom.children().remove().end().addClass("block-blank").html(t);$(".stock-banner",q).addClass("stock-banner-hide")},draggFetch:function(t){o.call(this,t,function(u){})},pannelParam:function(){this.sugWidth=681;var t=d();return{sugTpl:t,title:"添加股票",itemTpl:b(),content:'<div class="pannel-content"><div class="sug-content">'+t+"</div></div>",height:120,top:210}},addCb:function(t){var u=this;if($.isIE===6){$(".sui-dialog-stock-pannel").css({top:"+="+$(window).scrollTop()})}if(u.isSimp===true){u.expand()}if(!t){return}m.call(u);var v=u.AddPannel.componentWrap.find(".sui-dialog-stock-pannel .sug-link");u.AddPannel.body.delegate(".sug-button","click",function(w){u.addAction(v)}).delegate(".sug-link","keydown",function(w){if(w.keyCode==8){v.removeAttr("data-code").removeAttr("data-market")}}).delegate(".sug-link","click",function(w){if(u.sugInstance.cache){u.sugInstance.show()}});u.AddPannel.on("onhide",function(){v.val("").data("market","");u.sugInstance.cache=null;u.PlaceTips.show()})},addAction:function(u){var t=this;if(u&&u.val()!=""){if(!!u.attr("data-code")&&!!u.attr("data-market")){t.recomAddCb(u,function(){t.SuccessTips.show();u.val("").data("market","")})}else{if(t.sugInstance.resdata&&t.sugInstance.resdata.length>0){t.recomAddCb(null,function(){t.SuccessTips.show();u.val("").data("market","")},t.sugInstance.resdata[0].code,t.sugInstance.resdata[0].resourcename)}else{t.ErroTips.show()}}u.attr("data-code","");u.attr("data-market","");t.sugInstance.cache=null}},recomAddCb:function(v,x,t,y){var A=p.stocks;var y=v?v.attr("data-market"):y;var t=v?v.attr("data-code"):t;var w="";var B="_";var z=0;var u=this;var C=$(".stock-item",q);w=y+":"+t;this.addStock({stockcode:t,resourcename:y,rscids:w},x);return true},recomDelCb:function(t){this.delItem(t.data("code"),t.data("market"))},addStock:function(v,t){var u=this;var w={cmd:"add",rscids:v.rscids};o.call(u,w,function(x){if(w.cmd=="add"){if(x.errNo=="501"&&w.cmd=="add"){c.alertTips.show();return}else{if(x.errNo=="500"&&w.cmd=="add"){c.warnTips.show();return}else{if(x.errNo!="0"){c.failTips.show();return}}}}t&&t();p.stocks=[];for(var y in x.data.items){p.stocks.push(x.data.items[y])}u.freshDom(x.data.items)})},delItem:function(v,x){var t=this;if(!t.sorted){var u="";$(".stock-item",q).each(function(){u+=x+":"+v+"_"});$('.stock-item[data-code="'+v+'"]',q).remove();u=u.substr(0,u.length-1);var w={cmd:"del",rscids:u};t.draggFetch.call(this,w)}else{$('[data-code="'+v+'"] .del-icon',q).trigger("click")}}};function m(){var t=this;F.use("superui:component/suggestion",function(u){t.sugInstance=new u({componentWrap:$(".sug-content",t.AddPannel.body),identity:"stockAddPannel",input:$(".sug-link",t.AddPannel.body),width:691,url:$.url.escapeSSL("http://nssug.baidu.com/su?wd={wd}&prod=stock&json=1"),template:s,autoFill:null,focusShow:false})});F.use("superui:component/tips",function(u){t.ErroTips=new u({target:$(".sug-link",t.AddPannel.body),componentWrap:t.AddPannel.body,identity:"navsugerror",content:"请输入有效信息",timing:2000,model:"left",icons:"error",align:"left",arrowDown:false,theme:"white",autoShow:false});t.warnTips=new u({target:$(".sug-link",t.AddPannel.body),identity:"navsugerror",componentWrap:t.AddPannel.body,content:"您已添加过该股票",timing:2000,model:"left",icons:"warning",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"});t.SuccessTips=new u({target:$(".sug-link",t.AddPannel.body),identity:"navsugerror",componentWrap:t.AddPannel.body,content:"添加成功",timing:2000,model:"left",arrowDown:false,icons:"success",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"});t.alertTips=new u({target:$(".sug-link",t.AddPannel.body),identity:"navsugalert",componentWrap:t.AddPannel.body,content:"添加超过上限",timing:2000,model:"left",icons:"warning",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"});t.failTips=new u({target:$(".sug-link",t.AddPannel.body),identity:"stocksugfail",componentWrap:t.AddPannel.body,content:"添加失败",timing:2000,model:"left",icons:"error",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"})});F.use("superui:component/placeholder",function(u){t.PlaceTips=new u({componentWrap:$(".sug-link-wrap",t.AddPannel.body),top:1,left:30,identity:"mineAddSug",target:$(".sug-link",t.AddPannel.body),holderText:"输入股票名称/代码/拼音",height:30,lineheight:30})});t.sugInstance.on("onSelect",function(u){$(".sug-link",t.AddPannel.body).val(u.code).attr("data-code",u.code).attr("data-market",u.resourcename)})}function i(t){return l(t)}function d(){var t='<div class="stock-sug-wrap"><div class="sug-link-wrap"><input type="text" class="sug-link"/></div><div class="sug-button">添加股票</div></div>';return t}function b(){return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-code="{{=item.code}}" data-market="{{=item.market}}"><span class="recom-icon"></span><span class="recom-text">{{=item.title}}</span></div>'}function o(v,t){var u=this;v=F.mix(v,{tabid:e});$.ajaxpost("/home/subscribe/submit/manoperation",v,function(x){t&&t(x);if(parseInt(x.errNo)===0){if(v.cmd==="add"){var w=$(".mine-title-num span",q);w.html(parseInt(w.html())+1)}else{if(v.cmd==="del"){var w=$(".mine-title-num span",q);w.html(parseInt(w.html())-1)}}}h.fire("stockOpration",{oprateMod:e,opration:v.cmd.replace("_","-")})})}function a(u){var w=this;var v=w.sortFy({identity:"minestock",dragsort:"."+j,delSelector:".stock-del .del-icon",dataIdenti:"data-code",componentWrap:w.contentDom,containment:w.contentDom});this.sorted=true;var t={};var x="";this.draggsort=v;this.draggsort.on("onAfterSort",function(D){x="";var C=q.find(".s-mblock-content");for(var B=0,z=D.cache,y=z.length;B<y;B++){var A=C.find('[data-daraggsort="'+z[B]+'"]');x+=A.attr("data-market")+":"+A.attr("data-code")+"_"}x=x.substr(0,x.length-1);var E={cmd:"seq_in",rscids:x};u&&u.call(this,E)}).on("onSortDel",function(y){x=y.delItem.data("market")+":"+y.delItem.data("code");var z={cmd:"del",rscids:x};p.delStockCount=p.delStockCount?p.delStockCount+1:1;u&&u.call(w,z)})}r.init=n});F.addLog("mantpl:stock",{stockOpration:"1100002001",stockClick:"1100003001"});F.module("mantpl:video/mine",function(e,g,j){var k=$("#s_xmancard_mine .s-block-video");var o="video-item";var d='<span class="sp_sg_code">{{=it["code"]}}</span><span class="sp_sg_name">{{=it["name"]}}</span><span class="sp_sg_market">{{=it["market"]}}</span>';var h=$.parseJSON($.trim($("#s_minevideo_textarea").html()));var m=null;var c=15;var l=e("superui:component/dialog");function n(q){F.inherit(p,q);m=new p()}function p(){this.constructor();this.id=c;this.blockDom=k;this.recomBlock="video";this.contentDom=$(".s-mblock-content",k);this.editExpand=true;this.isBlank=!!parseInt(h.isBlank,10);this.init();this.bindEvent();this.hasAdd=false}p.prototype={bindEvent:function(){var q=this;k.delegate(".video-item","click",function(r){if(!q.sorted||$(this).attr("CANCELDRAG")){window.open($(this).data("href"));j.fire("videoLink",{oprateMod:c,opration:"click"})}}).delegate(".add-video","click",function(r){if($('#s_menus_wrapper [data-id="'+q.id+'"]')[0]){$('#s_menus_wrapper [data-id="'+q.id+'"]').trigger("click")}else{if(!q.blankAlert){q.blankAlert=new l({identity:"changeDir",content:"您还没有添加视频频道哦，快去添加！",hasClose:false,theme:"video-blank",buttons:[{type:"ok",title:"确定"}],autoShow:true});if($.isIE6){$(".sui-dialog-mask-video-blank").height($("body").height());$(".sui-dialog-video-blank").css({top:"+="+$(window).scrollTop()})}}else{q.blankAlert.show();if($.isIE6){$(".sui-dialog-mask-video-blank").height($("body").height())}}}})},editCb:function(){if(this.isSimp===true){this.expand()}if(!this.sorted){a.call(this,this.draggFetch)}else{$("."+o,k).removeAttr("CANCELDRAG")}},draggFetch:function(q){q=F.mix(q,{tabid:m.id});$.ajaxpost("/home/subscribe/submit/manoperation",q,function(r){if(q.cmd=="add"||q.cmd=="del"){}j.fire("videoOpration",{oprateMod:c,opration:q.cmd})})},unEditCb:function(){var q=this;$("."+o,k).attr("CANCELDRAG","1");if($("."+o,k).length===0){q.blankfy()}},refreshCb:function(q){this.contentDom.unbind("mousedown mouseup click").children().remove().end().remove();this.contentDom=$(q.html).filter(".s-mblock-content");$(".s-block-container",k).append(this.contentDom);$(".mine-title-num span",k).html($(".video-item",k).length);this.sorted=false;h=$.parseJSON($.trim($("#s_minevideo_textarea").html()));this.isBlank=(h.isBlank=="1")},blankfy:function(){var q='<div class="video-blank"><div class="add-video"></div></div>';this.isBlank=true;this.contentDom.children().remove().end().addClass("block-blank").html(q)},pannelParam:function(){this.sugWidth=681;var q=f();return{sugTpl:q,title:"添加视频",itemTpl:i()}},addCb:function(){var q=this;b.call(q)}};function i(){var q="";return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-id="{{=item.id}}"><span class="recom-icon"></span><span class="recom-text">{{=item.title}}</span></div>'}function f(){var q='<div class="stock-sug-wrap"><div class="sug-link-wrap"><input type="text" class="sug-link"/></div><div class="sug-button">添加视频</div></div>';return q}function b(){var q=this;var s=q.Suggestion;var r=q.Tips;q.sugInstance=new s({componentWrap:$(".sug-content",q.AddPannel.body),identity:"videoAddPannel",input:$(".sug-link",q.AddPannel.body),width:691,url:$.url.escapeSSL("http://nssug.baidu.com/su?wd={wd}&prod=video&json=1"),template:d,autoFill:null});q.ErroTips=new r({target:$(".sug-link",q.AddPannel.body),identity:"videosugerror",content:"请输入有效信息",timing:2000,model:"left",arrowDown:false,icons:"error",theme:"white",autoShow:false});q.sugInstance.on("onSelect",function(t){$(".sug-link",q.AddPannel.body).val(t.code).data("id",t.id)})}function a(r){var t=this;var s=t.sortFy({identity:"minevideo",dragsort:"."+o,delSelector:".video-del .del-icon",dataIdenti:"data-id",componentWrap:t.contentDom,containment:t.contentDom});t.sorted=true;var q={};var u="";s.drags.each(function(){var v=$(this).attr("data-daraggsort");q[v]=$(this).data("id")});s.on("onAfterSort",function(y){u="";for(var x=0,w=y.cache,v=w.length;x<v;x++){u+=q[w[x]]+"_"}u=u.substr(0,u.length-1);var z={cmd:"seq_in",rscids:u};r&&r.call(t,z)}).on("onSortDel",function(w){var x={cmd:"del",id:w.delItem.data("id")};r&&r.call(t,x);j.fire("videounsubscribe",{id:w.delItem.data("id")});var v=$(".mine-title-num span",k);v.html(parseInt(v.html())-1)})}g.init=n});F.addLog("mantpl:video",{videoLink:"1100003001",videoOpration:"1100002001"});F.module("mantpl:xingzuo/mine",function(b,d,g){var i=$("#s_xmancard_mine .s-block-xingzuo");var c=null;var h=b("superui:component/draggsort");var j=7;var m="constel-item";function l(n){f.prototype=$.extend({},n.prototype,f.prototype);c=new f()}function f(){this.constructor();this.id=j;this.hasSimp=false;this.blockDom=i;this.recomBlock="xingzuo";this.contentDom=$(".s-mblock-content",i);this.hasPannelBody=true;this.isBlank=!parseInt($(".mine-title-num span",i).html(),10);this.init();this.bindEvent()}f.prototype={bindEvent:function(){var n=this;i.delegate(".detail-tab-item","click",function(q){var p=$(this).attr("data-tabname");var o=$(this).closest(".constel-pannel");$(".constel-detail .cur-tab",o).removeClass("cur-tab");$(this).addClass("cur-tab");$(".tab-contents [data-tabname="+p+"]",o).addClass("cur-tab");if(i.hasClass("edting-block")){$(".edit-comp",i).trigger("click")}g.fire("xingzuoOpration",{oprateMod:j,opration:"to"+p,curxingzuo:$(".constel-head .cur-pannel",i).attr("data-pannel")})}).delegate("."+m,"click",function(o){if(!!$(this).attr("data-daraggsort")&&!$(this).attr("CANCELDRAG")){return}n.switchPannel($(this))}).delegate(".add-constell","click",function(o){n.add()}).delegate(".more","click",function(o){if(i.hasClass("edting-block")){$(".edit-comp",i).trigger("click")}g.fire("xingzuoClick",{oprateMod:j,opration:"fortuneclick",url:$(this).attr("href")})})},switchPannel:function(p){var q={cmd:"switch",tabname:""};if(p){$(".cur-pannel",i).removeClass("cur-pannel");var o=p.attr("data-pannel");p.addClass("cur-pannel");var n=$(".constel-content [data-pannel="+o+"]",i);$("[data-src]",n).each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")});n.addClass("cur-pannel");q.tabname=o}a(q)},editCb:function(){var n=this;if(this.isSimp==true){this.expand()}if(!$("."+m,i).attr("data-daraggsort")){k.call(n)}else{$("."+m,i).removeAttr("CANCELDRAG")}},unEditCb:function(){var n=$(".constel-head ."+m,i);if(n.length===0||(n.length===1&&!data)){this.blankFy()}else{$("."+m,i).attr("CANCELDRAG",1)}},refreshCb:function(n){this.contentDom.unbind("mousedown mouseup click").children().remove().end().remove();this.contentDom=$(n.html).filter(".s-mblock-content");$(".s-block-container",i).append(this.contentDom);$(".mine-title-num span",i).html($(".constel-head .constel-item",i).length);this.isBlank=!parseInt($(".mine-title-num span",i).html(),10)},pannelParam:function(){return{sugTpl:"",title:"添加星座",itemTpl:e(),content:'<div class="pannel-content"><div class="recom-content"></div></div>',height:177,top:210}},addCb:function(){if(this.isSimp==true){this.expand()}if($.isIE===6){$(".sui-dialog-xingzuo-pannel").css({top:"+="+$(window).scrollTop()})}},recomAddCb:function(q,n,o){var p=this;var r={cmd:"add",id:q.attr("data-id")};a(r,function(s){n&&n();o&&o();setTimeout(function(){p.refresh()},300)})},recomDelCb:function(r,o){var p=this;var n=r.attr("data-id");var s={cmd:"del",id:n};a(s,function(t){o&&o()});p.delItem(n);var q=$(".constel-head ."+m,i);if(q.length===0){this.blankFy()}},delItem:function(o,r){var p=$(".constel-head ."+m,i);var n=$(".mine-title-num span",i);if(p.length===0||(p.length===1&&!r)){$(".s-mblock-content",i).children().remove();n.html(0)}else{var q=$('.constel-content [data-pannel="'+o+'"]',i);var s=q.hasClass("cur-pannel");if(r&&s){this.switchPannel($('[data-daraggsort="'+r.cache[0]+'"]',i))}else{if(!r){if(!$("."+m,i).attr("data-daraggsort")){$('.constel-head [data-pannel="'+o+'"]').remove()}else{$('.constel-head [data-pannel="'+o+'"] .del-icon').trigger("click")}if(s){this.switchPannel($(".constel-head .constel-item:eq(0)",i))}}}n.html(parseInt(n.html())-1);q.remove()}},blankFy:function(){var o=this;var p='<div class="constell-blank"><div class="add-constell"></div></div>';o.contentDom.unbind("mousedown mouseup click").children().remove().end().addClass("block-blank").html(p);var n=$(".mine-title-num span",i);n.html(0);this.switchPannel(null);o.isBlank=true}};function k(){var o=this;o.draggsort=new h({componentWrap:$(".s-mblock-content .constel-head-content",i),identity:"mineconstel",dragsort:"."+m,dragHandle:".h",delAble:true,delSelector:".del-icon",containment:$(".s-mblock-content .constel-head",i),placeholder:false});var n={};o.draggsort.on("onAfterSort",function(t){qStr="";for(var s=0,q=t.cache,p=q.length;s<p;s++){var r=$(".constel-head-content",i).find('[data-daraggsort="'+q[s]+'"]');qStr+=(s===0?"":"_")+r.attr("data-pannel")}var u={cmd:"seq_in",ids:qStr};a(u)}).on("onSortDel",function(q){var p=q.delItem.data("pannel");var r={cmd:"del",id:p};a(r,function(){o.delItem(p,q)})})}function a(o,n){o=F.mix(o,{tabid:j});$.ajaxpost("/home/subscribe/submit/manoperation",o,function(p){n&&n(p)});g.fire("xingzuoOpration",{oprateMod:j,opration:o.cmd.replace("_","-"),curxingzuo:$(".constel-head .cur-pannel",i).attr("data-pannel")})}function e(){return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-id="{{=item.id}}"><span class="recom-icon"></span><span class="recom-text">{{=item.name}}</span></div>'}d.init=l});F.addLog("mantpl:xingzuo",{xingzuoOpration:"1100002001",xingzuoClick:"1100003001"});F.module("mantpl:lottery/countdown",function(d,f,k){var i=+new Date()-200,h=0;var j=s_session.portrait||"nologin";var g=function(s){var q=s+"";if(q.length<=3){return q}if(!/^(\+|-)?(\d+)(\.\d+)?$/.test(q)){return q}var o=RegExp.$1,m=RegExp.$2,r=RegExp.$3;var p=new RegExp();p.compile("(\\d)(\\d{3})(,|$)");while(p.test(m)){m=m.replace(p,"$1,$2$3")}return o+""+m+""+r};var e=function(r,s){r=r/100;var n="0 : 00 : 00.0";if(r<=0){return n}var m,q,u,p,o;m=Math.floor(r/864000);r=r%864000;q=Math.floor(r/36000);r=r%36000;u=Math.floor(r/600);r=r%600;p=Math.floor(r/10);r=r%10;o=r|0;q=q<10?("0"+q):q;u=u<10?("0"+u):u;p=p<10?("0"+p):p;return'<em class="num">'+m+"</em>天<em class='num'>"+q+"</em>小时<em class='num'>"+u+"</em>分<em class='num'>"+p+"</em>秒"};var a=function(r,o,n,p,m){var q=function(){var s=n-(+new Date()-i);if(s<0){m&&m();return}r.innerHTML=e(s,p);h=setTimeout(function(){q()},100)};q()};var l=function(t,p,r,q,n){if(!p){return}var m=p-window.sysTime*1000;if(m<=0){return}var s=Math.floor((r-m)/8);var o=function(u){if(u<=0||(r-u*s+m)<=0){n&&n();return}t.innerHTML=e(u*s+m,q);setTimeout(function(){o(u-1)},50)};o(7)};var c=function(p,n){var o=Math.ceil(n/8);var m=function(q){if(q>=n){p.innerHTML=g(n);return}else{p.innerHTML=g(q)}setTimeout(function(){m(q+o)},50)};m(o)};var b=function(m){i=+new Date()-200;var n=m;a(n[0],$(n).attr("data-time")*1000,(+$(n).attr("data-time")-window.sysTime)*1000,2,function(){setTimeout(function(){$(n).html("投注已截止")},200)})};f.init=b});F.module("mantpl:lottery/mine",function(i,u,d){var s=$("#s_xmancard_mine .s-block-lottery");var r=null;var c=i("superui:util/smDot");var t=i("superui:component/draggsort");var l=10;var h="lottery-item";var e=null;var g=0;var b=null;function o(v){m.prototype=$.extend({},v.prototype,m.prototype);r=new m();if($(".s-block-lottery .lottery-content")[0]){f();q()}d.fire("lotteryShow",{oprateMod:l,opration:$.trim($(".cur-pannel span").html())})}function f(v){$.ajaxget("/home/subscribe/data/manlotteryuserdata",function(x){var y="￥*****";var w=c.template(y,{varname:"it"});$(".s-lottery-user .num").html(w(x.data));if(g===0){k(x.data);n(x.data);r.carousel()}v&&v()})}function n(v){g=1;var w=$.extend({},v);delete w.balance;w.bd_bind=Boolean(v.bd_bind);$(".s-lottery-static-link").each(function(){$(this).attr("href",$(this).attr("href")+"&"+$.param(w))});$(".match-analyz a").each(function(){$(this).attr("href",$(this).attr("href")+"&"+$.param(w))})}function k(w){var v=$.parseJSON($.trim($("#data_links_user").html()));var x=$.extend({},w);delete x.balance;x.bd_bind=Boolean(w.bd_bind);$.each(v,function(y){if(this.linkcontent=="充值"){$(".user-charge-btn1").attr("href",this.linkurl+"&"+$.param(x))}if(this.linkcontent=="提现"){$(".user-charge-btn2").attr("href",this.linkurl+"&"+$.param(x))}if(this.linkcontent=="投注记录"){$(".user-record1").attr("href",this.linkurl+"&"+$.param(x))}if(this.linkcontent=="彩金卡兑现"){$(".user-record2").attr("href",this.linkurl+"&"+$.param(x))}e=w.balance})}var q=function(){$(".deadline-counter").each(function(){var v=this;d.use("lottery/countdown",function(w){w.init($(v))})})};function m(){this.constructor();this.id=l;this.hasSimp=false;this.blockDom=s;this.recomBlock="lottery";this.contentDom=$(".s-mblock-content",s);this.hasPannelBody=true;this.isBlank=!parseInt($(".mine-title-num span",s).html(),10);this.init();this.bindEvent()}m.prototype={bindEvent:function(){var v=this;s.delegate(".s-lottery-user .user-charge .user-charge-btn1","mouseover",function(w){$(this).addClass("s-opacity-background2")}).delegate(".s-lottery-user .user-charge .user-charge-btn1","mouseout",function(w){$(this).removeClass("s-opacity-background2")}).delegate(".s-lottery-user .user-charge .user-charge-btn2","mouseover",function(w){$(this).addClass("s-opacity-background2")}).delegate(".s-lottery-user .user-charge .user-charge-btn2","mouseout",function(w){$(this).removeClass("s-opacity-background2")}).delegate("."+h,"click",function(w){if(!!$(this).attr("data-daraggsort")&&!$(this).attr("CANCELDRAG")){return}v.switchPannel($(this))}).delegate(".add-lotteryl","click",function(w){v.add()}).delegate(".user-balance .text","click",function(w){if($(".user-balance .text").html()=="显示余额"){f(function(){$(".user-balance .text").html("隐藏余额");$(".user-balance .num").html("￥"+e)})}else{if($(".user-balance .text").html()=="隐藏余额"){$(".user-balance .text").html("显示余额");$(".user-balance .num").html("￥*****")}}d.fire("lotteryOpration",{oprateMod:l,opration:"balance"})}).delegate(".items-set-pagger","click",function(w){d.fire("lotteryOpration",{oprateMod:l,opration:"page"})}).delegate(".user-balance .refresh","click",function(w){$(".s-lottery-user .num").html("&nbsp;");if(!$(".s-lottery-user .num").hasClass("loading-gif")){$(".s-lottery-user .num").addClass("loading-gif")}f(function(){$(".s-lottery-user .num").removeClass("loading-gif");if($(".user-balance .text").html()=="隐藏余额"){$(".user-balance .num").html("￥"+e)}});d.fire("lotteryOpration",{oprateMod:l,opration:"refresh"})}).delegate(".type-curitem","click",function(w){$(this).closest(".type-selector").find(".type-items").toggle();d.fire("lotteryOpration",{oprateMod:l,opration:"type"})}).delegate(".type-item","click",function(x){var w=$(this).attr("data-type");var y=$(this).html();$(".result-pannel.cur-result-pannel",s).removeClass("cur-result-pannel");$('.result-pannel[data-type="'+w+'"]',s).removeClass("cur-result-pannel").addClass("cur-result-pannel");$(".date-selector.cur-date-selector",s).removeClass("cur-date-selector");$('.date-selector[data-type="'+w+'"]',s).removeClass("cur-date-selector").addClass("cur-date-selector");$(this).closest(".type-selector").find(".type-curitem").html(y).end().find(".type-items").hide()}).delegate(".date-curitem","click",function(w){$(this).closest(".date-selector").find(".date-items").toggle();d.fire("lotteryOpration",{oprateMod:l,opration:"date"})}).delegate(".date-item","click",function(y){var w=$(this).attr("data-date");var z=$(this).html();var x=$(this).parents("[data-type]").attr("data-type");$('.result-pannel[data-type="'+x+'"] .cur-date-pannel',s).removeClass("cur-date-pannel");$('.result-pannel[data-type="'+x+'"] .date-pannel[data-date="'+w+'"]',s).removeClass("cur-date-pannel").addClass("cur-date-pannel");$(this).closest(".date-selector").find(".date-curitem").html(z).end().find(".date-items").hide()}).delegate(".pagger-num","click",function(A){var w=$(this).parents(".items-set-pagger");var z=+w.attr("data-pall");var y=w.find(".cur-pagger");var B=y.attr("data-page");var x=0;if($(this).hasClass("pagger-up")){x=(+B+1);if(x>z){return}y.removeClass("cur-pagger");w.find('[data-page="'+x+'"]').removeClass("cur-pagger").addClass("cur-pagger")}else{if($(this).hasClass("pagger-down")){x=(+B-1);if(x<1){return}y.removeClass("cur-pagger");w.find('[data-page="'+x+'"]').removeClass("cur-pagger").addClass("cur-pagger")}else{x=$(this).attr("data-page");y.removeClass("cur-pagger");$(this).removeClass("cur-pagger").addClass("cur-pagger")}}$(this).parents(".date-pannel").find(".cur-set-pannel").removeClass("cur-set-pannel").end().find('.items-set[data-page="'+x+'"]').removeClass("cur-set-pannel").addClass("cur-set-pannel")}).delegate(".carousel","mouseenter mouseleave",function(w){if(w.type==="mouseenter"){v.toggleCarousel(true)}else{v.toggleCarousel(false)}}).delegate(".back-to-bet","click",function(w){}).delegate("a","click",function(w){if($(this).attr("data-name")){d.fire("lotteryOpration",{oprateMod:l,opration:$(this).attr("data-name"),url:$(this).attr("href")})}});$(document).on("mousedown",function(w){if(!$(w.target).parents(".date-selector")[0]){$(".date-items",s).hide()}if(!$(w.target).parents(".type-selector")[0]){$(".type-items",s).hide()}})},switchPannel:function(x){var y={cmd:"switch",tabname:""};if(x){$(".cur-pannel",s).removeClass("cur-pannel");var w=x.attr("data-pannel");x.addClass("cur-pannel");var v=$(".lottery-content [data-pannel="+w+"]",s);$("[data-src]",v).each(function(){$(this).attr("src",$(this).attr("data-src")).removeAttr("data-src")});v.addClass("cur-pannel");y.tabname=w}p(y);d.fire("lotteryShow",{oprateMod:l,opration:w})},editCb:function(){var v=this;if(this.isSimp==true){this.expand()}if(!$("."+h,s).attr("data-daraggsort")){j.call(v)}else{$("."+h,s).removeAttr("CANCELDRAG")}},unEditCb:function(){$("."+h,s).attr("CANCELDRAG",1)},refreshCb:function(v){this.contentDom.unbind("mousedown mouseup click").children().remove().end().remove();this.contentDom=$(v.html).filter(".s-mblock-content");$(".s-block-container",s).append(this.contentDom);$(".mine-title-num span",s).html($(".lottery-head .lottery-item",s).length);this.isBlank=!parseInt($(".mine-title-num span",s).html(),10);g=0;if($(".s-block-lottery .lottery-content")[0]){f();q()}},pannelParam:function(){return{sugTpl:"",title:"添加彩票",itemTpl:a(),content:'<div class="pannel-content"><div class="recom-content"></div></div>',height:177,top:210}},addCb:function(){if(this.isSimp==true){this.expand()}if($.isIE===6){$(".sui-dialog-lottery-pannel").css({top:"+="+$(window).scrollTop()})}},recomAddCb:function(y,v,w){var x=this;var z={cmd:"add",id:y.attr("data-id")};p(z,function(A){v&&v();w&&w();setTimeout(function(){x.refresh()},300)})},recomDelCb:function(y,w){var x=this;var v=y.attr("data-id");var z={cmd:"del",id:v};p(z,function(A){w&&w()});x.delItem(v)},delItem:function(w,z){var x=$(".lottery-head ."+h,s);if(x.length===0||(x.length===1&&!z)){this.blankFy()}else{var y=$('.lottery-content [data-pannel="'+w+'"]',s);var A=y.hasClass("cur-pannel");if(z&&A){this.switchPannel($('[data-daraggsort="'+z.cache[0]+'"]',s))}else{if(!z){if(!$("."+h,s).attr("data-daraggsort")){$('.lottery-head [data-pannel="'+w+'"]').remove()}else{$('.lottery-head [data-pannel="'+w+'"] .del-icon').trigger("click")}if(A){this.switchPannel($(".lottery-head .lottery-item:eq(0)",s))}}}var v=$(".mine-title-num span",s);v.html(parseInt(v.html())-1);y.remove()}},blankFy:function(){var w=this;var x='<div class="lotteryl-blank"><div class="add-lotteryl"></div></div>';w.contentDom.unbind("mousedown mouseup click").children().remove().end().addClass("block-blank").html(x);var v=$(".mine-title-num span",s);v.html(0);this.switchPannel(null);w.isBlank=true},domRun:function(w){var v=this;var y=b.length;var x=$(".s-lottery-user .carousel",s);v.curItem=w;x.find('[data-item="'+((v.curItem+1)%y)+'"]').stop().animate({left:0},500,function(){clearTimeout(v.carouselOut);v.carouselOut=setTimeout(function(){v.domRun(w+1)},5000)});x.find('[data-item="'+(v.curItem%y)+'"]').stop().animate({left:-x.width()},500,function(){$(this).css({left:x.width()})});v.curItem=(v.curItem+1)%y},carousel:function(){b=$.parseJSON($.trim($("#data_mine_lottery").html()));var v=this;var y='<&foreach $it as $key=>$oneItem&><a class="carousel-item" href="<&$oneItem.link&>" data-name="推广链接" target="_blank" data-item="<&$key&>"><&$oneItem.text&></a><&/foreach&>';var x=c.template(y,{varname:"it"});var w=$(".s-lottery-user .carousel",s);w.html(x(b));w.find('[data-item="0"]').css({left:0});setTimeout(function(){v.domRun(0)},2000)},toggleCarousel:function(w){var v=this;if(w){clearTimeout(v.carouselOut)}else{v.carouselOut=setTimeout(function(){v.domRun(v.curItem)},2000)}}};function j(){var w=this;w.draggsort=new t({componentWrap:$(".s-mblock-content .lottery-head-content",s),identity:"minelottery",dragsort:"."+h,dragHandle:".h",delAble:true,delSelector:".del-icon",containment:$(".s-mblock-content .lottery-head",s),placeholder:false});var v={};w.draggsort.on("onAfterSort",function(B){qStr="";for(var A=0,y=B.cache,x=y.length;A<x;A++){var z=$(".lottery-head-content",s).find('[data-daraggsort="'+y[A]+'"]');qStr+=(A===0?"":"_")+z.attr("data-pannel")}var C={cmd:"seq_in",ids:qStr};p(C)}).on("onSortDel",function(y){var x=y.delItem.data("pannel");var z={cmd:"del",id:x};p(z,function(){w.delItem(x,y)})})}function p(w,v){w=F.mix(w,{tabid:l});$.ajaxpost("/home/subscribe/submit/manoperation",w,function(x){v&&v(x)});d.fire("lotteryOpration",{oprateMod:l,opration:w.cmd.replace("_","-"),curlottery:$(".lottery-head .cur-pannel",s).attr("data-pannel")})}function a(){return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-id="{{=item.id}}"><span class="recom-icon"></span><span class="recom-text">{{=item.name}}</span></div>'}u.init=o});F.addLog("mantpl:lottery",{lotteryOpration:"1100002001",lotteryShow:"1100003001"});F.module("mantpl:novel/mine",function(k,r,f){var p=$("#s_xmancard_mine .s-block-novel");var i="novel-item-content";var s='<span class="sp_sg_code">{{=it["name"]}}</span><span class="sp_sg_name">{{=it["author"]}}</span><span class="sp_sg_market">{{=it["genre"]}}</span><span class="sp_sg_hidden">{{=it["uri"]}}</span>';var o=$.parseJSON($.trim($("#s_minenovel_textarea").html())||"{}");var c=null;var e=20;var h=k("superui:component/dialog");var j=k("superui:util/dot"),q=[];function m(t){F.inherit(g,t);c=new g();r.novelMine=c}function g(){this.constructor();this.id=e;this.blockDom=p;this.recomBlock="novel";this.contentDom=$(".s-mblock-content",p);this.editExpand=true;this.isBlank=!!parseInt(o.isBlank,10);this.init();this.hasPannelBody=true;this.bindEvent();this.addExShow=true}g.prototype={bindEvent:function(){var t=this;p.delegate(".novel-item","click",function(v){var u=$(this).parent();if(u.attr("canceldrag")=="1"||!u.attr("data-daraggsort")){f.fire("novelClick",{oprateMod:e,opration:"click",url:$(".novel-pic a",this).attr("href")})}if($(this).closest(".edting-block").length){v.preventDefault()}}).delegate(".add-novel","click",function(u){t.add()}).on("mouseenter mouseleave",".novel-item",function(u){if($.isIE===6){if(u.type==="mouseenter"){$(this).addClass("hover")}else{$(this).removeClass("hover")}}});f.listen("mancard:skeleton/presenter","switchCard",function(u){if(u.toCard=="100"&&($(".s-xmancard-novel").attr("data-subChange")==1)){$(".s-xmancard-novel").attr("data-subChange",0);t.refresh()}})},editCb:function(){if(this.isSimp===true){this.expand()}if(!this.sorted){a.call(this,this.draggFetch)}else{$("."+i,p).removeAttr("CANCELDRAG")}},draggFetch:function(t){t=F.mix(t,{tabid:c.id});$.ajaxpost("/home/subscribe/submit/manoperation",t,function(u){f.fire("novelOpration",{oprateMod:e,opration:t.cmd.replace("_","-")})})},unEditCb:function(){var t=this;$("."+i,p).attr("CANCELDRAG","1");if($("."+i,p).length===0){t.refresh();t.blankFy()}},refreshCb:function(t){this.contentDom.unbind("mousedown mouseup click");this.sorted=false;this.contentDom.remove();this.contentDom=$(t.html).filter(".s-mblock-content");p.find(".s-block-container").append(this.contentDom);p.find(".mine-title-num span").html(this.contentDom.find(".novel-item-content").length);if(this.contentDom.find(".novel-item-content").length>0){this.isBlank=false}else{this.isBlank=true}if(p.attr("data-status")=="edting"){this.edit()}},addItem:function(x){var u=['<div class="novel-item-content" data-uri="{{=it.uri}}">','<div class="novel-item">','<div class="del-icon"></div>','<div class="novel-pic">','<a href="{{=it.url}}" target="_blank" hidefocus>','<img src="{{=$.url.escapeSSL(it.img)}}" />',"</a>","</div>",'<div class="novel-info">','<p class="name"><a href="{{=it.url}}" title="{{=it.name}}" target="_blank">{{=it.name}}</a></p>','<p class="author">作者：{{=it.author}}</p>','<p class="up">更新：<a href="{{=it.up.url}}" title="{{=it.up.name}}" target="_blank" title="{{=it.up.name}}">{{=it.up.name}}</a></p>',"</div>","</div>","</div>"].join(""),t=j.template(u),v,w,y;if(x.errNo==0){this.serialize();v=t(x.data);w=p.find(".s-mblock-content");w.find(".novel-blank").remove();w.prepend(v);f.fire("novelsubscribe",{id:x.data.uri})}},serialize:function(){var u=$(".novel-item-content",p),x,v=0,y,t=q.length,w=[];if(t){for(;v<t;v++){y=q[v];x=u.eq(y);x.removeAttr("data-daraggsort canceldrag style");w.push(x)}$(".s-mblock-content",p).empty().append(w);q=[];this.refresh()}},pannelParam:function(){this.sugWidth=681;var t=d();return{sugTpl:t,title:"添加小说",itemTpl:b(),top:80,height:508}},addCb:function(t){var u=this;if($.isIE===6){$(".sui-dialog-novel-pannel").css({top:"+="+$(window).scrollTop()})}if(u.isSimp===true){u.expand()}if(!t){return}l.call(u);var v=u.AddPannel.componentWrap.find(".sui-dialog-novel-pannel .sug-link");u.AddPannel.body.delegate(".sug-button","click",function(w){u.addAction(v)}).delegate(".sug-link","keydown",function(w){if(w.keyCode==8){v.removeAttr("data-uri")}}).delegate(".sug-link","click",function(w){if(u.sugInstance.cache){u.sugInstance.show()}});u.AddPannel.on("onhide",function(){v.val("").data("uri","");u.sugInstance.cache=null})},addAction:function(u){var t=this;if(u&&u.val()!=""){if(!!u.attr("data-uri")){t.recomAddCb(u,function(){t.SuccessTips.show();u.val("").data("uri","")})}else{if(t.sugInstance.resdata&&t.sugInstance.resdata.length>0){t.recomAddCb(null,function(){t.SuccessTips.show();u.val("").data("uri","")},function(){},t.sugInstance.resdata[0].uri)}else{t.ErroTips.show()}}u.val("").attr("data-uri","");t.sugInstance.cache=null}},recomAddCb:function(x,t,u,w){var v=this;var y={cmd:"add",id:x?x.attr("data-uri"):w};n.call(this,y,function(z){if(y.cmd=="add"){if(!x){x=v.sugInstance.input}if(z.errNo=="501"&&y.cmd=="add"){F.use("superui:component/tips",function(A){new A({target:x,identity:"navsugalert",componentWrap:v.AddPannel.body,content:"添加超过上限！",timing:2000,model:"left",icons:"warning",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"}).show()});u&&u();return}else{if(z.errNo=="500"&&y.cmd=="add"){F.use("superui:component/tips",function(A){new A({target:x,identity:"navsugerror",componentWrap:v.AddPannel.body,content:"您已添加过该小说！",timing:2000,model:"left",icons:"warning",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"}).show()});u&&u();return}else{if(z.errNo!="0"){F.use("superui:component/tips",function(A){new A({target:x,identity:"novelsugfail",componentWrap:v.AddPannel.body,content:"添加失败",timing:2000,model:"left",icons:"error",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"}).show()});u&&u();return}}}}t&&t();u&&u();setTimeout(function(){v.addItem(z)},300)})},recomDelCb:function(w,u){var v=this;var t=w.attr("data-uri");var x={cmd:"del",id:t};n.call(this,x,function(y){u&&u()});v.delItem(t)},delItem:function(u,v){var t=$(".novel-item-content",p);if(t.length===0||(t.length===1)){this.blankFy()}else{t.filter('[data-uri="'+u+'"]').remove()}},blankFy:function(){var u=this;var v='<div class="novel-blank"><div class="add-novel"></div></div>';u.contentDom.unbind("mousedown mouseup click").addClass("block-blank").html(v);var t=$(".mine-title-num span",p);t.html(0);u.isBlank=true}};function b(){var t="";return'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-uri="{{=item.uri}}"><span class="recom-icon"></span><span class="recom-text">{{=item.name}}</span></div>'}function d(){var t='<div class="novel-sug-wrap"><div class="sug-link-wrap"><input type="text" class="sug-link"/></div><div class="sug-button">添加小说</div></div>';return t}function l(){var t=this;F.use("superui:component/suggestion",function(u){t.sugInstance=new u({componentWrap:$(".sug-content",t.AddPannel.body),identity:"novelAddPannel",input:$(".sug-link",t.AddPannel.body),width:681,url:$.url.escapeSSL("http://nssug.baidu.com/su?wd={wd}&prod=novel&json=1"),template:s,autoFill:null,focusShow:false})});F.use("superui:component/tips",function(u){t.ErroTips=new u({target:$(".sug-link",t.AddPannel.body),identity:"novelsugerror",content:"请输入有效信息",timing:2000,model:"left",arrowDown:false,icons:"error",theme:"white",autoShow:false});t.SuccessTips=new u({target:$(".sug-link",t.AddPannel.body),identity:"novelsugerror",componentWrap:t.AddPannel.body,content:"添加成功",timing:2000,model:"left",arrowDown:false,icons:"success",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"})});F.use("superui:component/placeholder",function(u){t.PlaceTips=new u({componentWrap:$(".sug-link-wrap",t.AddPannel.body),top:1,left:30,identity:"mineAddSug",target:$(".sug-link",t.AddPannel.body),holderText:"输入小说名称或作者笔名",height:30,lineheight:30})});t.sugInstance.on("onSelect",function(u){$(".sug-link",t.AddPannel.body).val(u.name).attr("data-uri",u.uri)})}function n(v,t){var u=this;v=F.mix(v,{tabid:e});$.ajaxpost("/home/subscribe/submit/manoperation",v,function(x){t&&t(x);if(parseInt(x.errNo)===0){if(v.cmd==="add"){var w=$(".mine-title-num span",p);w.html(parseInt(w.html())+1);u.isBlank=false}else{if(v.cmd==="del"){var w=$(".mine-title-num span",p);if(parseInt(w.html())-1>=0){w.html(parseInt(w.html())-1)}}}}f.fire("novelOpration",{oprateMod:e,opration:v.cmd.replace("_","-")})})}function a(u){var w=this;var v=w.sortFy({identity:"minenovel",dragsort:"."+i,delSelector:".del-icon",dataIdenti:"data-uri",componentWrap:w.contentDom,containment:w.contentDom});q=[];w.sorted=true;var t={};var x="";v.drags.each(function(){var y=$(this).attr("data-daraggsort");t[y]=$(this).data("uri");q.push(y)});v.on("onAfterSort",function(D){x="";var C=p.find(".s-mblock-content");for(var B=0,z=D.cache,y=z.length;B<y;B++){var A=C.find('[data-daraggsort="'+z[B]+'"]');x+=A.attr("data-uri")+"_"}x=x.substr(0,x.length-1);var E={cmd:"seq_in",rscids:x};u&&u.call(w,E);q=D.cache}).on("onSortDel",function(A){var B={cmd:"del",id:A.delItem.data("uri")};u&&u.call(w,B);var y=$(".mine-title-num span",p),z=$(".novel-item-content",p);if(parseInt(y.html())-1>=0){y.html(parseInt(y.html(),10)-1)}if(z.length==0||z.length===1){q=[]}f.fire("novelunsubscribe",{id:A.delItem.data("uri")})})}r.init=m;r.novelMine=c});F.addLog("mantpl:novel",{novelOpration:"1100002001",novelClick:"1100003001"});F.module("mantpl:mine/cards_manager",function(d,f,i){var l=d("superui:util/smDot");var k=d("superui:component/dialog");var b=d("superui:component/draggselect");var c=l.template(['<div class="s-minesetting" id="s_mine_manager" data-id="99">','<div class="s-minesetting-wrap clearfix">','<div class="s-minesetting-left">',"<h3>已关注</h3>",'<div class="s-minesetting-content">',"<&foreach $it.tplOnSet as $selected&>","<&if $selected.id&>",'<div class="s-mod-item <& if $selected.id == "100"&>s_mod_myitem<&/if&>"<& if $selected.id == "100"&> canceldrag="2"<&/if&> id="s_mineitem_<&$selected.id&>" data-id="<&$selected.id&>" data-imgname="<&$selected.imgname&>" data-name="<&$selected.name&>">','<div class="s-mod-icon">',"</div>",'<div class="s-mod-title" <&if $selected.id == "100"&>canceldrag="2"<&/if&>>',"<&$selected.name&>","</div>","</div>","<&/if&>","<&/foreach&>","</div>",'<div class="nomore-tips-left">拖动到这里可以继续关注</div>',"</div>",'<div class="s-minesetting-right">',"<h3>未关注</h3>",'<div class="s-minesetting-content">',"<&foreach $it.tplOffSet as $unselected&>","<&if $unselected.id&>",'<div class="s-mod-item" id="s_mineitem_<&$unselected.id&>" data-id="<&$unselected.id&>" data-imgname="<&$unselected.imgname&>" data-name="<&$unselected.name&>">','<div class="s-mod-icon">',"</div>",'<div class="s-mod-title">',"<&$unselected.name&>","</div>","</div>","<&/if&>","<&/foreach&>","</div>",'<div class="nomore-tips-right">拖动到这里可以取消关注</div>',"</div>","</div>",'<div class="setting-arrow setting-arrow-bottom">',"<em></em>","</div>","</div>"].join(""),{varname:"it"});var j=".s-minesetting-left .s-minesetting-content";var h=".s-minesetting-right .s-minesetting-content";var m="s-mod-item";var e="."+m;var n=31;var g=144;function a(){this.manageTpl="";this.topDom=$("#s_xmancard_mine");this.initManager=false}a.prototype={constructor:a,init:function(o,r,p,q){this.mainData=o;this.enterBtn=r;this.hideCb=p;this.$topDom=q;this.initManager=true},renderView:function(){var o=this;o.dialog=new k({identity:"minesetting",width:653,content:c(this.mainData),position:function(){return{bottom:n,left:25}},theme:"minesetting",autoShow:true,hasMask:false,hasClose:true,componentWrap:o.topDom.find(".tips-manager-area"),hackToTop:false});o.dialog.on("onHide",function(){o.showed=false;o.enterBtn.removeClass("edting-btn-text");o.hideCb&&o.hideCb()});o.bindEvent()},bindEvent:function(){this.dialog.body.on("mouseenter mouseleave",".s-mod-item",function(o){if(o.type==="mouseenter"){$(this).removeClass("mod-hover").addClass("mod-hover")}else{$(this).removeClass("mod-hover")}});this.sortFy()},sortFy:function(){var o=this;var p=o.dialog;var q;o.draggselect=new b({identity:"minesetting",containment:p.body,selected:p.body.find(j),unselected:p.body.find(h),dragsort:e,cansort:false});o.judgeEmpty();o.draggselect.on("onBeforeSelectSwap",function(){o.draggselect.selected.parentoffset=$(".s-minesetting-left .s-minesetting-content").offset();o.draggselect.unselected.parentoffset=$(".s-minesetting-right .s-minesetting-content").offset()}).on("onSelectSwap",function(r){r.dragItem&&r.dragItem.removeClass("mod-hover");o.judgeEmpty()}).on("onBeforeSelect",function(r){q=r.dragItem;q.css("zoom","0")}).on("onAfterSelect",function(r){setTimeout(function(){q.css("zoom","1")},50)})},judgeEmpty:function(){var o=this;var p=o.dialog;if(o.draggselect.selected.cache.length===0){$(".nomore-tips-left",p.body).show()}else{$(".nomore-tips-left",p.body).hide()}if(o.draggselect.unselected.cache.length===0){$(".nomore-tips-right",p.body).show()}else{$(".nomore-tips-right",p.body).hide()}},toggle:function(){var o=this;if(!o.showed){o.show()}else{o.hide()}},show:function(){var o=this;o.computePos();o.dialog.show();if(o.shouldReflow){o.reflow()}o.showed=true;o.enterBtn.removeClass("edting-btn-text").addClass("edting-btn-text")},hide:function(){var o=this;o.dialog.hide();o.showed=false;o.enterBtn.removeClass("edting-btn-text")},destroy:function(){var o=this;if(o.initManager){o.showed=false;o.initManager=false;o.dialog.window.remove();o.dialog.mask&&o.dialog.mask.remove();o.dialog=null;return true}return false},computePos:function(){var o=this;var p=o.enterBtn.offset().top-o.$topDom.offset().top;if(p<g){o.dialog.window.css({bottom:"",top:n});o.dialog.window.find(".setting-arrow").removeClass("setting-arrow-bottom").addClass("setting-arrow-top")}else{o.dialog.window.css({bottom:n,top:""});o.dialog.window.find(".setting-arrow").removeClass("setting-arrow-top").addClass("setting-arrow-bottom")}},reflow:function(){var o=this;o.shouldReflow=true;o.draggselect.selected.collapse();o.draggselect.selected.sort(false,true)}};return new a()});F.addLog("mantpl:mine/view",{manageOpt:"1100001002"});F.module("mantpl:mine/view",function(e,f,g){var h=e("superui:util/smDot");var d='<div class="recom-content"><&foreach $cards as $oneItem&><&if $oneItem.id&><div class="recom-item" data-id="<&$oneItem.id&>"><span class="recom-icon"></span><span class="recom-text"><&$oneItem.name&></span></div><&/if&><&/foreach&></div>';var i=e("superui:component/tips");var c=h.template(d,{varname:"cards"});function b(){this.$topDom=$("#s_xmancard_mine");$("#s_xmancard_mine .s-mine-wrapper .s-code-blocks:first-child").find(".set-totop").css("color","#999")}b.prototype={showDialog:function(m,l){var k=this;if(!!k.addPannel){k.addPannel.body.html(c(m.tplOffSet));k.addPannel.show();return}F.use("superui:component/dialog",function(n){k.addPannel=new n({identity:"mineblank",content:c(m.tplOffSet),hasClose:true,theme:"mine-blank-pannel sui-dialog-mine-pannel",autoShow:true,height:188,width:491,top:"50%",title:"添加关注"});if($.isIE===6){$("#sui-dialog-mask").height($("#bottom_container").offset().top+$("#bottom_container").outerHeight())}var o=false;k.addPannel.window.on("click",".recom-item",function(s){if(o){return}o=true;var q=$(this);var r=q.attr("data-id");var p=!q.hasClass("item-added");if(p){q.addClass("item-added");a.call(k,"addTips",q,{flashHide:true,wrap:k.addPannel.window})}else{q.removeClass("item-added");a.call(k,"delTips",q,{content:"取消成功！",flashHide:true,wrap:k.addPannel.window})}setTimeout(function(){o=false},600);l&&l(r,p)}).on("mouseenter",".recom-item",function(q){var p=$(this);if(p.hasClass("item-added")){a.call(k,"hoverTips",p,{content:"已添加，点击取消",flashHide:true,icons:"",wrap:k.addPannel.window})}});k.addPannel.on("onHide",function(){g.fire("manageOpt",{opType:"layerclose",opVal:-1})})})},addBlock:function(k,q,p,m){var l=this;if(l.$topDom.find(".s-all-blank")[0]){l.$topDom.find(".s-all-blank").hide()}var o=null;if(!(o=l.$topDom.find(".s-block-"+q))[0]&&k){var n=p.tplOnSet.length;var r=false;while(n--){var s=null;if(r&&(s=$(".s-block-"+p.tplOnSet[n].ename,l.$topDom))[0]){break}if(p.tplOnSet[n].id===m){r=true}}if(n===-1){l.$topDom.find(".s-mine-wrapper").prepend(j(k.html,q))}else{s.after(j(k.html,q))}}else{l.$topDom.find(".s-mine-wrapper").append(o);o.show()}if($.isIE===6){setTimeout(function(){$("#sui-dialog-mask").height($("#bottom_container").offset().top+$("#bottom_container").outerHeight())},200)}},delBlock:function(k,l){$(".s-block-"+k,this.$topDom).hide();if($.isIE===6){setTimeout(function(){$("#sui-dialog-mask").height($("#bottom_container").offset().top+$("#bottom_container").outerHeight())},200)}}};function j(l,k){return'<div class="s-code-blocks s-block-'+k+'" data-block="'+k+'" data-status="normal"><div class="s-block-container">'+l+"</div></div>"}function a(m,k,n){var l=this;if(!l.hideTout){l.hideTout={}}if(!l[m]){l[m]=new i(F.mix({target:k,identity:m+"manage",content:n.content||"添加成功",arrowUp:false,icons:"success",arrowLeft:"center",align:"center",autoShow:true,componentWrap:n.wrap},n))}else{if(n.flashHide){clearTimeout(l.hideTout[m])}l[m].hide();l[m].target=k;l[m].show()}if(n.flashHide){l.hideTout[m]=setTimeout(function(){l[m].hide()},1000)}}return new b()});F.module("mantpl:mine/model",function(d,f,h){var i=$.parseJSON($.trim($("#s_minetpl_textarea").html()));var c=100;var j={};function b(){}var k={sort:function(m,p){var n=[];for(var o=0,l=i.tplOffSet.length;o<l;o++){n[o]=i.tplOffSet[o].id}$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"seq_in",idsOn:p.ids.join("_"),idsOff:n.join("_"),tabid:c},function(q){m&&m(q)});for(var o=0,l=p.ids.length;o<l;o++){j[p.ids[o]]=o}i.tplOnSet.sort(function(q,r){return(j[q.id]-j[r.id])})},top:function(l,o){var m=i.tplOnSet.length;while(m--){if(+i.tplOnSet[m].id===+o.id){var n=i.tplOnSet.splice(m,1);i.tplOnSet.unshift(n[0]);break}}}};var a={tplData:function(l,m){l&&l(i);return i},mineHtml:function(l,m){$.ajaxget("/home/subscribe/data/mancardmine?id="+m.id,function(n){l&&l(n)})}};var e={card:function(n,r){var m=i.tplOffSet.length;var p=[];var o=[];var q=r.id;while(m--){if(i.tplOffSet[m].id===q){i.tplOnSet.push(i.tplOffSet[m]);i.tplOffSet.splice(m,1)}else{o.unshift(i.tplOffSet[m].id)}}m=i.tplOnSet.length;while(m--){p.unshift(i.tplOnSet[m].id)}var l={idsOn:p,idsOff:o};$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"add",idsOn:p.join("_"),idsOff:o.join("_"),id:q,tabid:c},function(s){n&&n(s)});return l}};var g={card:function(m,q){var l=i.tplOnSet.length;var o=[];var n=[];var p=q.id;while(l--){if(i.tplOnSet[l].id===p){i.tplOffSet.push(i.tplOnSet[l]);i.tplOnSet.splice(l,1)}else{o.unshift(i.tplOnSet[l].id)}}l=i.tplOffSet.length;while(l--){n.unshift(i.tplOffSet[l].id)}$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"del",idsOn:o.join("_"),idsOff:n.join("_"),id:p,tabid:c},function(r){m&&m(r)})}};b.prototype={get:function(m,l,n){return(a[m]&&a[m](l,n))||false},set:function(m,l,n){return(k[m]&&k[m](l,n))||false},add:function(m,l,n){return(e[m]&&e[m](l,n))||false},del:function(m,l,n){return(g[m]&&g[m](l,n))||false}};return new b()});F.module("mantpl:mine/amine",function(h,s,b){var n=$("#s_xmancard_mine");var r=h("superui:util/dot");var a=h("superui:component/suggestion");var i=h("superui:component/placeholder");var q=h("superui:component/draggsort");var f=h("superui:component/tips");var c={NORMAL:"normal",EDITING:"edting",EXPENDED:"expand"};var d={EDITING:"edting-block"};var p=".s-setbar";function m(){this.reqParam={addParam:null,editParam:null,expandParam:null,refreshParam:null};this.id=null;this.blockDom=null;this.__toolDom=null;this.blockName="mine";this.Suggestion=a;this.PlaceHolder=i;this.Tips=f;this.Dot=r;this.Draggsort=q}m.prototype={constructor:m,init:function(){this.blockName=this.blockDom&&this.blockDom.attr("data-block");this.__toolDom=this.blockDom.find(p);this.blockDom.attr("data-status",c.NORMAL);this.contentDom=this.contentDom||this.blockDom.find(".s-mblock-content");this.hasAdd=true;this.isSimp=!!parseInt(this.blockDom.find(".s-setbar").attr("data-issimp"));this.__bindEvent();this.isBlank=+$(".mine-title-num span",this.blockDom).html()===0?true:false;this.buttonFy()},setAttr:function(t){$.extend(this,t)},trimDom:function(v){if(v[0]){var u=v[0].childNodes;for(var t in u){if(u[t]&&u[t].nodeType===3){v[0].removeChild(u[t])}}}},__bindEvent:function(){var t=this;n.delegate(".s-block-"+t.blockName,"mouseenter mouseleave",function(u){if(u.type=="mouseenter"){if(t.blockDom.attr("data-status")===c.NORMAL){t.__toolDom.show();t.buttonFy()}}else{t.__toolDom.hide()}}).delegate(".s-block-"+t.blockName+" .set-btn","click",function(v){var u=$(this).attr("data-cmd");t[u]&&t[u]();b.fire("usetool",{id:"5138100001",oprateMod:t.id,opType:u});v.stopPropagation()}).delegate(".s-block-"+t.blockName+" .toggle-btn","click",function(v){var u=$(this).attr("data-cmd");t[u]&&t[u](null,true);b.fire("usetool",{id:"5138100001",oprateMod:t.id,opType:u})}).delegate(".s-block-"+t.blockName+" .s-mblock-title","click",function(u){if(!t.blockDom.hasClass("edting-block")){if(t.blockDom.hasClass("s-mblock-up")){b.fire("usetool",{oprateMod:t.id,opType:"expand"});t.expand()}else{b.fire("usetool",{oprateMod:t.id,opType:"unexpand"});t.unexpand()}b.fire("cardresize")}}).delegate(p,"click",function(u){u.stopPropagation()});b.listen("mancard:subscribe/subscribe","refresh",function(u){if(u.tabid==t.id||u.param.type==t.blockDom.attr("data-block")){setTimeout(function(){if(t.addExShow){t.exshow(null,true)}else{t.refresh()}},600)}})},buttonFy:function(){var t=this;if(t.isBlank){t.__toolDom.find(".set-edit").hide();t.__toolDom.find(".set-expand").hide();t.__toolDom.find(".set-refresh").hide();t.__toolDom.find(".edit-class").css({display:"none"})}else{t.__toolDom.find(".set-edit").show();t.__toolDom.find(".set-expand").show();t.__toolDom.find(".set-refresh").show();var u=($.isIE===6||$.isIE===7)?"inline":"inline-block";t.__toolDom.find(".edit-class").css({display:u})}if(t.hasAdd){t.__toolDom.find(".set-add").show()}else{t.__toolDom.find(".set-add").hide()}},add:function(){var u=this;var t=u.outAddPannel();var v=false;this.addCb&&this.addCb(t);if(!t){return}u.AddPannel.componentWrap.find(".sui-dialog-"+u.blockName+"-pannel").delegate(".recom-item","mouseenter mouseleave mouseup",function(x){if(x.type==="mouseup"){if(v){return}if($(this).hasClass("item-added")){v=true;var w=this;u.recomDelCb&&u.recomDelCb($(this),function(){$(w).removeClass("item-added");o.call(u,"delTips",$(w),{content:"取消成功！",flashHide:true});setTimeout(function(){v=false},800)})}else{v=true;var w=this;u.recomAddCb&&u.recomAddCb($(w),function(){$(w).addClass("item-added");o.call(u,"addTips",$(w),{flashHide:true})},function(){setTimeout(function(){v=false},800)})}}else{if(x.type==="mouseenter"){if($(this).hasClass("item-added")){o.call(u,"hoverTips",$(this),{content:"已添加，点击取消",flashHide:false,icons:""})}else{if($.isIE===6){$(this).addClass("recom-hover")}}}else{if(x.type==="mouseleave"){if($(this).hasClass("item-added")){u.hoverTips&&u.hoverTips.hide()}else{if($.isIE===6){$(this).removeClass("recom-hover")}}}}}})},totop:function(){var v=this;var u="";if(v.blockDom.is(".s-code-blocks:first")){return}n.find(".s-mine-wrapper").prepend(v.blockDom);$(".set-totop").css("color","#333");$("#s_xmancard_mine .s-mine-wrapper .s-code-blocks:first-child").find(".set-totop").css("color","#999");v.__toolDom.stop().fadeOut(200);var t=[];$(".s-code-blocks:visible",n).each(function(){t.push($(this).attr("data-block"))});b.fire("totop",{id:v.id});j(v.id,{cmd:"totop",tabid:100,topid:t.join("_")})},outAddPannel:function(){var u=this;var t=u.pannelParam&&u.pannelParam();if(u.AddPannel){u.AddPannel.show();u.AddPannel.body.find(".recom-content").html('<img src="'+s_domain.staticUrl+'static/mantpl/img/mine/loading_72b1da62.gif" class="loading-img"/>');if(u.hasPannelBody){l(u.recomBlock,function(v){u.AddPannel.body.find(".recom-content").html(k(v.data,t.itemTpl))})}return false}F.use("superui:component/dialog",function(v){u.AddPannel=new v({identity:"changeDir",content:typeof t.content=="undefined"?e(t):t.content,hasClose:true,theme:u.blockName+"-pannel sui-dialog-mine-pannel",autoShow:true,height:t.height,width:841,top:t.top||308,title:t.title});if($.isIE===6){$("#sui-dialog-mask").height($(document.body).height())}});if(u.hasPannelBody){l(u.recomBlock,function(v){u.AddPannel.body.find(".recom-content").html(k(v.data,t.itemTpl))})}return true},edit:function(){var t=this;t.blockDom.attr("data-status",c.EDITING).addClass(d.EDITING);t.__toolDom.hide();if(!t.editDom){t.editDom=$(".edit-tool",t.blockDom)}t.editDom.show();t.editCb&&t.editCb();$("#s_mancard_main .s-more-bar").trigger("click")},unedit:function(){var t=this;t.blockDom.attr("data-status",c.NORMAL).removeClass(d.EDITING);t.__toolDom.show();t.editDom.hide();t.unEditCb&&t.unEditCb();t.buttonFy()},unexpand:function(t){var u=this;u.isSimp=true;u.unexshow(t,false);j(u.id,{cmd:"setSimp",isSimp:"1",tabid:u.id});u.reqParam=$.extend({},u.reqParam);u.reqParam.refreshParam=u.reqParam.refreshParam||{};u.reqParam.refreshParam.isSimp=1},expand:function(t,u){var v=this;v.isSimp=false;j(v.id,{cmd:"setSimp",isSimp:"0",tabid:v.id});v.exshow(t,false);v.reqParam=$.extend({},v.reqParam);v.reqParam.refreshParam=v.reqParam.refreshParam||{};v.reqParam.refreshParam.isSimp=0},unexshow:function(t,u){this.blockDom.removeClass("s-mblock-up").addClass("s-mblock-up");t&&t()},exshow:function(t,u){this.blockDom.removeClass("s-mblock-up");t&&t()},refresh:function(t){var u=this;u.loading(true);g(u.id,function(v){u.loading(false);if(t){t.call(u,v)}else{u.refreshCb&&u.refreshCb.call(u,v)}},u.reqParam&&u.reqParam.refreshParam)},sortFy:function(x,t){var v=this;var w={componentWrap:$(".s-mblock-content",v.topDom),dragHandle:".h",delAble:true,containment:$(".s-mblock-content",v.blockDom),placeholder:false,preventShake:true};$.extend(w,x);var u=new q(w);return(this.draggsort=u)},loading:function(t){var u=this;if(t){u.blockDom.addClass("virtual");if(!u.loadingDom){u.loadingDom=$('<div class="block-loading"></div>');u.blockDom.append(u.loadingDom)}u.loadingDom.show()}else{u.blockDom.removeClass("virtual");u.loadingDom.hide()}}};function o(v,t,w){var u=this;if(!u[v]){u[v]=new f(F.mix({target:t,identity:v+"manage",content:w.content||"添加成功",arrowUp:false,icons:"success",arrowLeft:"center",align:"left",autoShow:true},w))}else{if(w.flashHide){clearTimeout(u.hideTout)}u[v].hide();u[v].target=t;u[v].show()}if(w.flashHide){u.hideTout=setTimeout(function(){u[v].hide()},1000)}}function e(t){var u='<div class="pannel-content"><div class="sug-content">#{sugTpl}</div><div class="recom-content"><img src="#{staticUrl}static/mantpl/img/mine/loading_72b1da62.gif" class="loading-img"/></div></div>';return $.formatString(u,{staticUrl:window.s_domain.staticUrl,sugTpl:t.sugTpl})}function k(u,v){var t='{{~it.dirs :oneDir:index}}<div class="one-class"><div class="class-title">{{=oneDir.dirName}}</div><div class="class-recoms">{{~oneDir.items :item:i}}#{itemTpl}{{~}}</div></div>{{~}}';return r.compile($.formatString(t,{itemTpl:v}))({dirs:u})}function l(v,t){var u=(v==="nplus")?"/home/"+v+"/data/manrecom":"/home/subscribe/data/manrecom"+v;$.ajaxget(u,function(w){t&&t(w)})}function g(w,t,v){var u="";u=(v&&"&"+$.param(v))||"";$.ajaxget("/home/subscribe/data/mancardmine?id="+w+u,function(x){t&&t(x)})}function j(v,u,t){$.ajaxpost("/home/subscribe/submit/manoperation",u||{},function(w){t&&t()})}return m});F.addLog("mantpl:mine",{usetool:"1100001001"});F.addLog("mantpl:mine/presenter",{manageOpt:"1100001002"});F.module("mantpl:mine/presenter",function(i,z,b){var o=i("mantpl:mine/view");var t=i("mantpl:mine/amine");var c=i("mantpl:mine/model");var a=i("mantpl:mine/cards_manager");var r=o.$topDom;var m=c.get("tplData");var p=m.tplOnSet;var j={};var d={};var k=100;function w(){n();q();e();v()}function v(){$("#s_content_"+k).attr("data-waterpara","noload=1;")}function e(){if(r.parents(".s-content").attr("data-loaded")==="1"){s()}}function q(){for(var C=0,A=p.length;C<A;C++){var D="mantpl:"+p[C].ename+"/mine";F.call(D,"init",t)}var B=m.tplOffSet.concat(m.tplOnSet);for(C=0,A=B.length;C<A;C++){j[+B[C].id]=B[C].ename}C=m.tplOnSet.length;while(C--){d[m.tplOnSet[C].id]=true}}function n(){r.on("click",".blank-add-btn",function(A){o.showDialog(m,g);b.fire("manageOpt",{opType:"blankadd",opVal:-1})}).on("click",".tips-manager-btn",function(B){var A=this;if(!a.initManager){a.init(m,$(A),h,r);a.renderView();u(a.draggselect)}a.toggle();b.fire("manageOpt",{opType:a.showed?"manageshow":"managehide",opVal:-1});B.stopPropagation()}).on("click",".manager-notify",function(A){A.stopPropagation()}).on("mouseenter",function(A){if(!a.initManager){F.call("mantpl:mine/cards_manager","")}});$(document).on("mousedown",function(A){if(a.showed&&!$(A.target).closest(".sui-dialog-minesetting")[0]&&!$(A.target).closest(".tips-manager-btn")[0]){a.hide();b.fire("manageOpt",{opType:"managehide",opVal:-1})}});b.listen("mancard:skeleton/card","cardloaded",function(A){if(A.cardId==100){s()}});b.listen("mantpl:mine/amine","totop",function(A){c.set("top",null,{id:A.id});a.destroy()});b.listen("mancard:subscribe/subscribe","refresh",function(B){var A=m.tplOffSet.length;while(A--){if(+m.tplOffSet[A].id===+B.tabid){y(B.tabid);a.destroy()}}})}function l(){r.find(".s-mine-wrapper .s-all-blank").show();a.destroy()}function h(){var A=m.tplOnSet.length;if(A===0){r.removeClass("s-mine-blank").addClass("s-mine-blank")}for(var B=0;B<A;B++){y(m.tplOnSet[B].id,true)}A=m.tplOffSet.length;for(var B=0;B<A;B++){f(m.tplOffSet[B].id,true)}}function g(B,A){if(A){y(B);b.fire("manageOpt",{opType:"layeradd",opVal:B})}else{f(B);b.fire("manageOpt",{opType:"layerdel",opVal:B})}}function y(C,B){var A="mantpl:"+j[C]+"/mine";!B&&c.add("card",null,{id:C});if(!d[C]){c.get("mineHtml",function(D){o.addBlock(D,j[C],m,C);F.call(A,"init",t)},{id:C});d[C]=true}else{if($(".s-block-"+j[C]+" .edit-tool").css("display")=="block"){$(".s-block-"+j[C]+" .edit-tool .edit-comp").trigger("click")}o.addBlock(null,j[C],m,C)}r.removeClass("s-mine-blank")}function f(B,A){!A&&c.del("card",null,{id:B});o.delBlock(j[B],B);if(m.tplOnSet.length===0){r.removeClass("s-mine-blank").addClass("s-mine-blank").find(".s-mine-wrapper .s-all-blank").show();l()}}function u(A){A.on("onSelectSwap",function(G){switch(G.type){case"added":var E=G.dragItem.attr("data-id");c.add("card",null,{id:E});b.fire("manageOpt",{opType:"manageadd",opVal:E});case"switch":var C=A.selected.drags;var B=A.selected.cache;var D=[];F.each(B,function(H){D.push(C.eq(H).attr("data-id"))});c.set("sort",null,{ids:D});break;case"remove":var E=G.dragItem.attr("data-id");c.del("card",null,{id:E});b.fire("manageOpt",{opType:"managedel",opVal:E});break}if(G.type==="switch"){b.fire("manageOpt",{opType:"managesort"})}x()})}function x(){if(!a.showed){a.shouldReflow=true;h()}}function s(){r.removeClass("s-mine-split");if($.isIE==6){$(".sui-dialog-mask-nav-pannel").height($("body").height())}}z.init=w});F.call("mantpl:mine/presenter","init");